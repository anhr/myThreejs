{"version":3,"file":"myThreejs.module.js","sources":["../../loadFileNodeJS/index.js","../../loadScriptNodeJS/index.js","../../loadScriptNodeJS/loadScript.js","../../loadFileNodeJS/loadFile.js","../../cookieNodeJS/index.js","../../cookieNodeJS/cookie.js","../index.js"],"sourcesContent":["/**\r\n * node.js version of the synchronous download of the file.\r\n * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/\r\n *\r\n * Copyright 2011 Data Arts Team, Google Creative Lab\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n */\r\n\r\n//The myRequest is cross-browser XMLHttpRequest wrapper.\r\nfunction myRequest( options ) {\r\n\r\n\tthis.loadXMLDoc = function () {\r\n\t\tvar req;\r\n\r\n\t\tif ( window.XMLHttpRequest ) {\r\n\t\t\treq = new XMLHttpRequest();\r\n\t\t\tif ( !req )\r\n\t\t\t\tthrow \"new XMLHttpRequest() failed!\"\r\n\t\t}\r\n\t\telse if ( window.ActiveXObject ) {\r\n\t\t\treq = this.NewActiveXObject();\r\n\t\t\tif ( !req )\r\n\t\t\t\tthrow \"NewActiveXObject() failed!\"\r\n\t\t}\r\n\t\telse throw \"myRequest.loadXMLDoc(...) failed!\";\r\n\t\treturn req;\r\n\t}\r\n\r\n\tthis.NewActiveXObject = function () {\r\n\t\ttry { return new ActiveXObject( \"Msxml2.XMLHTTP.6.0\" ); }\r\n\t\tcatch ( e ) { }\r\n\t\ttry { return new ActiveXObject( \"Msxml2.XMLHTTP.3.0\" ); }\r\n\t\tcatch ( e ) { }\r\n\t\ttry { return new ActiveXObject( \"Msxml2.XMLHTTP\" ); }\r\n\t\tcatch ( e ) { }\r\n\t\ttry { return new ActiveXObject( \"Microsoft.XMLHTTP\" ); }\r\n\t\tcatch ( e ) { }\r\n\t\tErrorMessage( 'This browser does not support XMLHttpRequest. Probably, your security settings do not allow Web sites to use ActiveX controls installed on your computer. Refresh your Web page to find out the current status of your Web page or enable the \"Initialize and script ActiveX controls not marked as safe\" and \"Run Active X controls and plug-ins\" of the Security settings of the Internet zone of your browser.' );\r\n\t\treturn null;\r\n\t}\r\n\r\n\tthis.XMLHttpRequestStart = function ( onreadystatechange, async ) {\r\n\r\n\t\tthis.XMLHttpRequestStop();//For compatibility with IE Windows Phone\r\n\r\n\t\tthis.req.onreadystatechange = onreadystatechange;\r\n\r\n\t\t//ATTENTION!!! do not works in IE\r\n\t\tif ( \"onerror\" in this.req ) {\r\n\t\t\tthis.req.onerror = function ( event ) {\r\n\t\t\t\tErrorMessage( \"XMLHttpRequest error. url: \" + this.url, false, false );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.XMLHttpRequestReStart( async );\r\n\t}\r\n\r\n\tthis.getUrl = function () {\r\n\t\tif ( ( typeof this.url == 'undefined' ) || ( this.url == null ) ) {\r\n\t\t\tthis.url = \"XMLHttpRequest.xml\";\r\n\t\t}\r\n\t\treturn this.url + ( this.params ? this.params : \"\" );\r\n\t}\r\n\r\n\tthis.XMLHttpRequestReStart = function ( async ) {\r\n\t\ttry {\r\n\t\t\tif ( typeof async == 'undefined' )\r\n\t\t\t\tasync = true;\r\n\t\t\tthis.req.open( \"GET\", this.getUrl(), async );\r\n\t\t\tif ( async ) {\r\n\t\t\t\tvar timeout = ( 60 + 30 ) * 1000;//��������!!! �������� ������ ���� ������ CSocketWaitEvent::WaitResponse\r\n\t\t\t\tif ( \"timeout\" in this.req )//for IE6\r\n\t\t\t\t\tthis.req.timeout = timeout;\r\n\t\t\t\tif ( \"ontimeout\" in this.req )\r\n\t\t\t\t\tthis.req.ontimeout = function () {\r\n\t\t\t\t\t\tErrorMessage( 'XMLHttpRequest timeout', false, false );\r\n\t\t\t\t\t}\r\n\t\t\t\telse {//for Safari, IE6\r\n\t\t\t\t\tclearTimeout( this.timeout_id_SendReq );\r\n\t\t\t\t\tthis.timeout_id_SendReq = setTimeout( function () {\r\n\t\t\t\t\t\tErrorMessage( 'XMLHttpRequest timeout 2', false, false );\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\t, timeout );\r\n\t\t\t\t\t//console.log(\"setTimeout this.req.timeout_id_SendReq = \" + this.req.timeout_id_SendReq);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.req.send( null );\r\n\t\t} catch ( e ) {\r\n\t\t\tErrorMessage( e.message + \" url: \" + this.url, false, false );\r\n\t\t}\r\n\t}\r\n\r\n\tthis.XMLHttpRequestStop = function () {\r\n\t\t//console.log(\"XMLHttpRequestStop(...)\");\r\n\t\tif ( this.req == null )\r\n\t\t\treturn;\r\n\t\tthis.req.abort();\r\n\t}\r\n\r\n\tthis.ProcessReqChange = function ( processStatus200 ) {\r\n\t\tvar req = this.req;\r\n\t\tif ( ( typeof isIE === 'undefined' ) || !isIE ) {\r\n\t\t\t//\tconsole.log(\"processReqChange(); req.statusText: \" + req.statusText + \". req.status = \" + req.status + \". req.readyState = \" + req.readyState + \". req.responseText: \" + req.responseText);\r\n\t\t}\r\n\t\t// only if req shows \"complete\"\r\n\t\t//http://www.w3schools.com/ajax/ajax_xmlhttprequest_onreadystatechange.asp\r\n\t\t//http://xmlhttprequest.ru/w3c\r\n\t\tswitch ( req.readyState ) {\r\n\t\t\tcase 4://request finished and response is ready\r\n\t\t\t\t{\r\n\t\t\t\t\tif ( typeof req.status == \"unknown\" ) {//IE5 timeout\r\n\t\t\t\t\t\tconsoleError( 'typeof XMLHttpRequest status == \"unknown\"' );\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//� �� ���� ��������� switch ���� � ������\r\n\t\t\t\t\tif ( req.status == 200 )//OK)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tclearTimeout( this.timeout_id_SendReq );\r\n\t\t\t\t\t\treturn processStatus200( this );\r\n\t\t\t\t\t}//200://OK\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tErrorMessage( \"Invalid XMLHttpRequest status : \" + req.status + \" url: \" + this.url );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1://server connection established\r\n\t\t\tcase 2://request received\r\n\t\t\tcase 3://processing request\r\n\t\t\t\tbreak;\r\n\t\t\t//\t\tcase 404:\r\n\t\t\tcase 0://request not initialized\r\n\t\t\tdefault:\r\n\t\t\t\tthrow \"processReqChange(); req.readyState = \" + req.readyState;\r\n\t\t\t\tbreak;\r\n\t\t}//switch(req.readyState)\r\n\t\treturn true;\r\n\t}\r\n\r\n\tthis.processStatus200Error = function () {\r\n\t\tvar error = this.GetElementText( 'error', true );\r\n\t\tif ( error ) {\r\n\t\t\tErrorMessage( error );\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tthis.GetElementText = function ( tagName, noDisplayErrorMessage ) {\r\n\t\tvar xmlhttp = this.req;\r\n\t\tif ( !xmlhttp.responseXML ) {\r\n\t\t\tif ( noDisplayErrorMessage != true )\r\n\t\t\t\tErrorMessage( 'GetXMLElementText(xmlhttp, ' + tagName + '); xmlhttp.responseXML is null.\\nxmlhttp.responseText:\\n' + xmlhttp.responseText );\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar element = xmlhttp.responseXML.getElementsByTagName( tagName );\r\n\r\n\t\t//ATTENTION!!! For IE set the content-type m_HttpResponse.SetContentType(\"text/xml\");\r\n\r\n\t\tif ( element.length == 0 ) {\r\n\t\t\tif ( noDisplayErrorMessage != true )\r\n\t\t\t\tErrorMessage( 'GetXMLElementText(xmlhttp, \"' + tagName + '\"); element.length == ' + element.length );\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\t\tvar text = \"\";\r\n\t\tfor ( var i = 0; i < element.length; i++ ) {\r\n\t\t\tif ( typeof ( element[i].textContent ) == 'undefined' ) {\r\n\t\t\t\tif ( typeof ( element[i].text ) == 'undefined' ) {\r\n\t\t\t\t\tErrorMessage( 'GetXMLElementText(xmlhttp, ' + tagName + '); element[' + i + '].text) == undefined' );\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t}\r\n\t\t\t\tif ( text != \"\" )\r\n\t\t\t\t\ttext += \" \";\r\n\t\t\t\ttext += element[i].text;//IE\r\n\t\t\t}\r\n\t\t\telse text += element[i].textContent;//Chrome\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\r\n\tif ( options.data ) {\r\n\t\tthis.req = options.data.req;\r\n\t\tthis.url = options.data.url;\r\n\t\tthis.params = options.data.params;\r\n\t} else {\r\n\t\ttry {\r\n\t\t\tthis.req = this.loadXMLDoc();\r\n\t\t} catch ( e ) {\r\n\t\t\tvar message;\r\n\t\t\tif ( typeof e.message == 'undefined' )\r\n\t\t\t\tmessage = e;\r\n\t\t\telse message = e.message;\r\n\t\t\tErrorMessage( \"Your browser is too old and is not compatible with our site.\\n\\n\"\r\n\t\t\t\t+ window.navigator.appName + \" \" + window.navigator.appVersion + \"\\n\\n\" + message );\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\tif ( !this.req ) {\r\n\t\tconsoleError( \"Invalid myRequest.req: \" + this.req );\r\n\t\treturn;\r\n\t}\r\n\r\n\tfunction ErrorMessage( error ) {\r\n\r\n\t\tconsole.error( error );\r\n\t\toptions.onerror( error );\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * @callback onerror\r\n * @param {string} str - error details\r\n */\r\n\r\n/**\r\n * Synchronous load file\r\n * @param {string} url URL of an external file.\r\n * @param {Object} [options] followed options is available. Optional.\r\n * @param {Function} [options.onload] function () The onload event occurs when a script has been loaded. Optional.\r\n * @param {onerror} [options.onerror] function ( str ) The onerror event occurs when an error has been occured. Optional.\r\n * @returns {string} file content\r\n * @example\r\n * \r\n\t//Simplest example.\r\n\tdocument.getElementById( \"elID\" ).innerHTML = loadFile.sync('element.html');\r\n *\r\n * @example\r\n *\r\n\t//onload, onerror events.\r\n\tdocument.getElementById( \"elID\").innerHTML = loadFile.sync( 'element.html',\r\n\t{\r\n\t\tonload: function ( response ) {\r\n\r\n\t\t\tvar str = 'file has been loaded successfully';\r\n\t\t\tconsole.log( str );\r\n\r\n\t\t},\r\n\t\tonerror: function ( str, e ) {\r\n\r\n\t\t\tconsole.error( str );\r\n\r\n\t\t},\r\n\t}, );\r\n */\r\nfunction sync( url, options ) {\r\n\r\n\toptions = options || {};\r\n\toptions.onload = options.onload || function () { };\r\n\toptions.onerror = options.onerror || function () { };\r\n\r\n\tvar response,\r\n\t\trequest = new myRequest( options );\r\n\trequest.url = url;\r\n\trequest.XMLHttpRequestStart(\r\n\r\n\t\tfunction () {//onreadystatechange\r\n\r\n\t\t\trequest.ProcessReqChange( function ( myRequest ) {//processStatus200\r\n\r\n\t\t\t\tif ( myRequest.processStatus200Error() )\r\n\t\t\t\t\treturn;\r\n\t\t\t\tresponse = myRequest.req.responseText;\r\n\t\t\t\tconsole.log( 'loadFile.sync.onload() ' + url );\r\n\t\t\t\toptions.onload( response, url );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\t\t, false//Synchronous mode\r\n\r\n\t);\r\n\t//console.log( 'sync(' + url + ')' );\r\n\treturn response;\r\n\r\n}\r\n\r\n/**\r\n * display a text to HTML\r\n * @param {string} str source text\r\n * @returns {string} escaped text\r\n */\r\nfunction escapeHtml( str ) {\r\n\r\n\treturn str.replace( /[&<>\"'\\/]/g, function ( s ) {\r\n\r\n\t\tvar entityMap = {\r\n\r\n\t\t\t\"&\": \"&amp;\",\r\n\t\t\t\"<\": \"&lt;\",\r\n\t\t\t\">\": \"&gt;\",\r\n\t\t\t'\"': '&quot;',\r\n\t\t\t\"'\": '&#39;',\r\n\t\t\t\"/\": '&#x2F;'\r\n\r\n\t\t};\r\n\r\n\t\treturn entityMap[s];\r\n\r\n\t} );\r\n}\r\n\r\nexport { sync, escapeHtml };\r\n","/**\r\n * node.js version of the load JavaScript file\r\n * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/\r\n *\r\n * Thanks to:\r\n *http://javascript.ru/forum/events/21439-dinamicheskaya-zagruzka-skriptov.html\r\n *https://learn.javascript.ru/onload-onerror\r\n *\r\n * Copyright 2011 Data Arts Team, Google Creative Lab\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n */\r\n//Please download https://github.com/anhr/loadFileNodeJS into ../loadFileNodeJS folder\r\nimport { sync as loadFileSync, escapeHtml } from '../loadFileNodeJS/index.js';\r\n/**\r\n * @callback onerror\r\n * @param {string} str - error details\r\n */\r\n\r\n/**\r\n * Synchronous load JavaScript file\r\n * @param {string} src URL of an external script file.\r\n * @param {Object} [options] followed options is available. Optional.\r\n * @param {Function} [options.onload] function () The onload event occurs when a script has been loaded. Optional.\r\n * @param {onerror} [options.onerror] function ( str ) The onerror event occurs when an error has been occured. Optional.\r\n * @param {string}[options.appendTo] The node to which the new script will be append. Optional. Default is head node\r\n * @param {Object|string}[options.tag] The script's tag attributes (Object) or tag type (string). Optional.\r\n * Available tag types:\r\n *\t'style' - load a style file (.css extension)\r\n * @param {string} [options.tag.name] tag name. Default is 'script'\r\n * @param {Object} [options.tag.attribute] tag attribute. Optional.\r\n * @param {string} options.tag.attribute.name attribute name. Default is 'type'\r\n * @param {string} options.tag.attribute.value attribute value. Default is 'text/javascript'\r\n *\r\n * @example\r\n * \r\n\t//Simplest example. Append script into head node.\r\n\tloadScript.sync( 'sync.js' );\r\n\r\n * @example\r\n * \r\n\t//onload, onerror events. Append script into \"appendto\" element\r\n\tloadScript.sync( 'sync.js',\r\n\t\t{\r\n\t\t\tonload: function ( response ) {\r\n\r\n\t\t\t\tvar str = 'file has been loaded successfully';\r\n\t\t\t\tconsole.log( str );\r\n\r\n\t\t\t},\r\n\t\t\tonerror: function ( str, e ) {\r\n\r\n\t\t\t\telSync2Res.style.color = 'red';\r\n\r\n\t\t\t},\r\n\t\t\tappendTo: document.getElementById( \"appendto\" ),\r\n\t\t},\r\n\t);\r\n *\r\n * @example\r\n *\r\n\t//Append style into head node.\r\n\tloadScript.sync( \"controls.css\",\r\n\t{\r\n\t\t//style rel=\"stylesheet\"\r\n\t\ttag: {\r\n\r\n\t\t\tname: 'style',\r\n\t\t\tattribute: {\r\n\r\n\t\t\t\tname: 'rel',\r\n\t\t\t\tvalue: 'stylesheet',\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\r\n */\r\nfunction sync( src, options ) {\r\n\r\n\toptions = options || {};\r\n\toptions.onload = options.onload || function () { };\r\n\toptions.onerror = options.onerror || function () { };\r\n\toptions.appendTo = options.appendTo || document.getElementsByTagName( 'head' )[0];\r\n\r\n\tif ( isScriptExists( options.appendTo, src ) ) {\r\n\r\n\t\t//options.onerror( 'duplicate downloading of the ' + src + ' file' );\r\n\t\toptions.onload();\r\n\t\treturn;\r\n\r\n\t}\r\n\r\n\tif ( src instanceof Array ) {\r\n\r\n\t\tvar error,\r\n\t\t\toptionsItem = {\r\n\r\n\t\t\t\tappendTo: options.appendTo,\r\n\t\t\t\ttag: options.tag,\r\n\t\t\t\tonload: function ( response, url ) {\r\n\t\t\t\t\r\n\t\t\t\t\tconsole.log( 'loadScript.sync.onload: ' + url );\r\n\t\t\t\t\r\n\t\t\t\t},\r\n\t\t\t\tonerror: function ( str ) {\r\n\r\n\t\t\t\t\toptions.onerror( str );\r\n\t\t\t\t\terror = str;\r\n\r\n\t\t\t\t},\r\n\r\n\t\t\t};\r\n\t\tfor ( var i = 0; i < src.length; i++ ) {\r\n\r\n\t\t\tvar item = src[ i ];\r\n\t\t\tloadScriptBase( function ( script ) {\r\n\r\n\t\t\t\tscript.setAttribute( \"id\", item );\r\n\t\t\t\tscript.innerHTML = loadFileSync( item, optionsItem );\r\n\r\n\t\t\t}, optionsItem );\r\n\t\t\tif ( error !== undefined )\r\n\t\t\t\tbreak;\r\n\r\n\t\t};\r\n\t\tif ( error === undefined )\r\n\t\t\toptions.onload();\r\n\r\n\t} else loadScriptBase( function ( script ) {\r\n\r\n\t\tscript.setAttribute( \"id\", src );\r\n\t\tscript.innerHTML = loadFileSync( src, options );\r\n\r\n\t}, options );\r\n\r\n}\r\n\r\n/**\r\n * @callback onerrorasync\r\n * @param {string} str - error details\r\n * @param {Object} e - event\r\n */\r\n\r\n/**\r\n * Asynchronous load JavaScript file\r\n * @param {string|string[]} src URL of an external script file or array of the script file names.\r\n * @param {Object} [options] followed options is available. Optional.\r\n * @param {Function} [options.onload] function () The onload event occurs when a script has been loaded. Optional.\r\n * @param {onerrorasync} [options.onerror] function ( str, e ) The onerror event occurs when an error has been occured. Optional.\r\n * @param {string}[options.appendTo] The node to which the new script will be append. Optional. Default is head node\r\n * @param {Object}[options.tag] The script's tag attributes. Optional.\r\n * @param {string} options.tag.name tag name. Default is 'script'\r\n * @param {Object} [options.tag.attribute] tag attribute. Optional.\r\n * @param {string} options.tag.attribute.name attribute name. Default is 'type'\r\n * @param {string} options.tag.attribute.value attribute value. Default is 'text/javascript'\r\n*\r\n * @example\r\n * \r\n\t//Simplest example. Append script into head node.\r\n\tloadScript.async( \"JavaScript.js);\r\n * \r\n * @example\r\n *\r\n\t//onload, onerror events. Append script into \"appendto\" element\r\n\tloadScript.async( \"JavaScript.js\",\r\n\t{\r\n \t\tonload: function () {\r\n \r\n \t\t\tvar str = 'file has been loaded successfully';\r\n \t\t\tconsole.log( str );\r\n \r\n \t\t},\r\n \t\tonerror: function ( str, e ) {\r\n \r\n \t\t\tconsole.error( str );\r\n \r\n \t\t},\r\n \t\tappendTo: document.getElementById( \"appendto\" ),\r\n \r\n \t}\r\n \r\n  );\r\n *\r\n * @example\r\n *\r\n\t//loading of array of JavaScript files. Append script into head node.\r\n\tloadScript.async( [\r\n \t\t\"JavaScript1.js\",\r\n \t\t\"JavaScript2.js\",\r\n \t],\r\n \t{\r\n \t\tonload: function () {\r\n \r\n \t\t\tvar str = 'file has been loaded successfully';\r\n \t\t\tconsole.log( str );\r\n \r\n \t\t},\r\n \t\tonerror: function ( str, e ) {\r\n \r\n \t\t\tconsole.error( str );\r\n \r\n \t\t},\r\n \r\n \t}\r\n \r\n  );\r\n */\r\nfunction async( src, options ) {\r\n\r\n\toptions = options || {};\r\n\toptions.appendTo = options.appendTo || document.getElementsByTagName( 'head' )[ 0 ];\r\n\toptions.onload = options.onload || function () {};\r\n\r\n\tvar isrc;\r\n\r\n\tfunction async( srcAsync ) {\r\n\r\n\t\tfunction next() {\r\n\r\n\t\t\tif ( src instanceof Array && ( isrc < ( src.length - 1 ) ) ) {\r\n\r\n\t\t\t\tisrc++;\r\n\t\t\t\tasync( src[isrc] );\r\n\r\n\t\t\t} else options.onload();\r\n\r\n\t\t}\r\n\r\n\t\tif ( isScriptExists( options.appendTo, srcAsync, options.onload ) ) {\r\n\r\n\t\t\tnext();\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tloadScriptBase( function ( script ) {\r\n\r\n\t\t\tscript.setAttribute( \"id\", srcAsync );\r\n\r\n\t\t\tfunction _onload() {\r\n\r\n\t\t\t\tconsole.log( 'loadScript.async.onload() ' + srcAsync );\r\n\t\t\t\tif ( options.onload !== undefined ) {\r\n\r\n\t\t\t\t\tnext();\r\n/*\r\n\t\t\t\t\tif ( src instanceof Array && ( isrc < ( src.length - 1 ) ) ) {\r\n\r\n\t\t\t\t\t\tisrc++;\r\n\t\t\t\t\t\tasync( src[isrc] );\r\n\r\n\t\t\t\t\t} else options.onload();\r\n*/\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( script.readyState && ! script.onload ) {\r\n\r\n\t\t\t\t// IE, Opera\r\n\t\t\t\tscript.onreadystatechange = function () {\r\n\r\n\t\t\t\t\tif ( script.readyState == \"complete\" ) {\r\n\r\n\t\t\t\t\t\t// �� ������ �������� loaded\r\n\t\t\t\t\t\tif ( options.onload !== undefined ) options.onload(); // (2)\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( script.readyState == \"loaded\" ) {\r\n\r\n\t\t\t\t\t\tsetTimeout( options.onload, 0 ); // (1)\r\n\r\n\t\t\t\t\t\t// ������� ����������, ����� �� �������� �� complete\r\n\t\t\t\t\t\tthis.onreadystatechange = null;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// Rest\r\n\t\t\t\tscript.onload = _onload;\r\n\r\n\t\t\t\tscript.onerror = function ( e ) {\r\n\r\n\t\t\t\t\tvar str = 'loadScript: \"' + this.src + '\" failed';\r\n\t\t\t\t\tif ( options.onerror !== undefined )\r\n\t\t\t\t\t\toptions.onerror( str, e );\r\n\t\t\t\t\tconsole.error( str );\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t}\r\n\r\n\t\t\tscript.src = srcAsync;\r\n\r\n\t\t}, options );\r\n\r\n\t}\r\n\r\n\tif ( src instanceof Array ) {\r\n\r\n\t\tisrc = 0;\r\n\t\tasync( src[ isrc ] );\r\n\r\n\t} else async( src );\r\n\r\n}\r\n\r\nfunction loadScriptBase( callback, options ) {\r\n\r\n\toptions.tag = options.tag || {};\r\n\tif ( typeof options.tag === \"string\" ) {\r\n\r\n\t\tswitch ( options.tag ) {\r\n\r\n\t\t\tcase 'style':\r\n\t\t\t\toptions.tag = {\r\n\r\n\t\t\t\t\tname: 'style',\r\n\t\t\t\t\tattribute: {\r\n\r\n\t\t\t\t\t\tname: 'rel',\r\n\t\t\t\t\t\tvalue: 'stylesheet',\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault: console.error( 'Invalid options.tag: ' + options.tag );\r\n\t\t\t\treturn;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\toptions.tag.name = options.tag.name || 'script';\r\n\tvar script = document.createElement( options.tag.name );\r\n\r\n\toptions.tag.attribute = options.tag.attribute || {};\r\n\toptions.tag.attribute.name = options.tag.attribute.name || \"type\";\r\n\toptions.tag.attribute.value = options.tag.attribute.value || 'text/javascript';\r\n\tscript.setAttribute( options.tag.attribute.name, options.tag.attribute.value );\r\n\r\n\tcallback( script );\r\n\toptions.appendTo.appendChild( script );\r\n\r\n}\r\n\r\nfunction isScriptExists( elParent, srcAsync, onload ) {\r\n\r\n\tvar scripts = elParent.querySelectorAll( 'script' );\r\n\tfor ( var i = 0; i < scripts.length; i++ ) {\r\n\r\n\t\tvar child = scripts[i];\r\n\t\tif ( child.id === srcAsync ) {\r\n\r\n/*\r\n\t\t\tif ( onload !== undefined )\r\n\t\t\t\tonload();\r\n*/\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\treturn false;\r\n\r\n}\r\n\r\nexport { async, sync, escapeHtml };\r\n","﻿/**\r\n * node.js version of download of the scripts.\r\n * \r\n * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/\r\n *\r\n * Copyright 2011 Data Arts Team, Google Creative Lab\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n */\r\n\r\nimport { sync, async } from './index.js';\r\n\r\nvar loadScript = {\r\n\r\n\tsync: sync,\r\n\tasync: async,\r\n\r\n}\r\nexport default loadScript;\r\n","/**\r\n * node.js version of the synchronous download of the file.\r\n * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/\r\n *\r\n * Copyright 2011 Data Arts Team, Google Creative Lab\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n */\r\n\r\nimport { sync } from './index.js';\r\n\r\nvar loadFile = {\r\n\r\n\tsync: sync,\r\n\r\n}\r\n\r\n//export { loadFile };\r\nexport default loadFile;\r\n","/**\r\n * node.js version of the cookie.\r\n * Cookies let you store user information in web pages.\r\n * @see {@link https://www.w3schools.com/js/js_cookies.asp}\r\n *\r\n * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/\r\n *\r\n * Copyright 2011 Data Arts Team, Google Creative Lab\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n */\r\n\r\nexport { isEnabled, set, setObject, get, getObject, copyObject, remove, defaultCookie };\r\n\r\n/**\r\n * Is the cookie enabled in your web browser?\r\n * @returns {boolean} true if cookie enabled\r\n * \r\n * @example\r\n\tvar isCookieEnabled = cookie.isEnabled('age', 25);\r\n */\r\nfunction isEnabled() {\r\n\r\n\treturn navigator.cookieEnabled;\r\n\t//Enable cookie\r\n\t//Chrome: Settings/Show advanced settings.../Privacy/Content settings.../Cookies/Allow local data to be set\r\n\r\n}\r\n\r\n/**\r\n * Set a cookie.\r\n * @param {string} name cookie name.\r\n * @param {any} value cookie value.\r\n * @param {Date} [cookie_date] expiry date (in UTC time). Optional.\r\n * @example\r\n\tcookie.set('age', 25);\r\n */\r\nfunction set( name, value, cookie_date ) {\r\n\r\n\tif ( !isEnabled() ) {\r\n\r\n\t\tconsoleCookieEnabled();\r\n\t\treturn;\r\n\r\n\t}\r\n\tvalue = value.toString();\r\n\t//http://ruseller.com/lessons.php?rub=28&id=593\r\n\tif ( cookie_date === undefined ) {\r\n\r\n\t\tcookie_date = new Date();  // Curent date and time\r\n\t\tcookie_date.setTime( cookie_date.getTime() + 1000 * 60 * 60 * 24 * 365 );//expiry date is one year\r\n\r\n\t}\r\n\tdocument.cookie = name + \"=\" + value + ( ( typeof settings == 'undefined' ) ? '' : settings ) + \"; expires=\" + cookie_date.toGMTString();\r\n\tif ( document.cookie === '' )\r\n\t\tconsole.error( 'document.cookie is empty' );\r\n\r\n}\r\n\r\n/**\r\n * sets an object into cookie.\r\n * @param {string} name cookie name.\r\n * @param {any} object an object for saving into cookie\r\n */\r\nfunction setObject( name, object ) {\r\n\r\n\tset( name, JSON.stringify( object ) );\r\n\r\n};\r\n\r\n/**\r\n * Get a cookie.\r\n * @param {string} name cookie name.\r\n * @param {any} [defaultValue] cookie default value. Optional.\r\n * @returns {string} cookie value or defaultValue if cookie was not found.\r\n * @example\r\n\tvar age = cookie.get('age', 25);\r\n */\r\nfunction get( name, defaultValue ) {\r\n\r\n\tif ( !isEnabled() ) {\r\n\r\n\t\tconsoleCookieEnabled();\r\n\t\treturn;\r\n\r\n\t}\r\n\t//http://ruseller.com/lessons.php?rub=28&id=593\r\n\tvar results = document.cookie.match( '(^|;) ?' + name + '=([^;]*)(;|$)' );\r\n\r\n\tif ( results )\r\n\t\treturn ( unescape( results[2] ) );\r\n\tif ( typeof defaultValue == 'undefined' )\r\n\t\treturn '';\r\n\treturn defaultValue;\r\n\r\n}\r\n\r\n/**\r\n * gets an object from cookie.\r\n * @param {string} name name of the object\r\n * @param {any} options load an object from cookie into options\r\n * @param {Object} optionsDefault copy to options this default object if named object is not exists in the cookie.\r\n */\r\nfunction getObject( name, options, optionsDefault ) {\r\n\r\n//\tnew defaultCookie().getObject( name, options, JSON.parse( get( name, JSON.stringify( optionsDefault ) ) ) );\r\n\tnew defaultCookie().getObject( name, options, copyObject( name, optionsDefault ) );\r\n\r\n};\r\n\r\n/**\r\n * gets an object from cookie and returns a copy of object.\r\n * @param {string} name name of the object\r\n * @param {Object} objectDefault copy to options this default object if named object is not exists in the cookie.\r\n * @returns copy of object from cookie\r\n */\r\nfunction copyObject( name, objectDefault ) {\r\n\r\n\treturn JSON.parse( get( name, JSON.stringify( objectDefault ) ) );\r\n\r\n}\r\n\r\n/**\r\n * Remove cookie\r\n * @param {string} name cookie name.\r\n */\r\nfunction remove( name ) {\r\n\r\n\tif ( !isEnabled() ) {\r\n\r\n\t\tconsoleCookieEnabled();\r\n\t\treturn;\r\n\r\n\t}\r\n\t//http://ruseller.com/lessons.php?rub=28&id=593\r\n\tvar cookie_date = new Date();  // ������� ���� � �����\r\n\tcookie_date.setTime( cookie_date.getTime() - 1 );\r\n\tdocument.cookie = name += \"=; expires=\" + cookie_date.toGMTString();\r\n\r\n}\r\n\r\nfunction consoleCookieEnabled() {\r\n\r\n\tconsole.error( 'navigator.cookieEnabled = ' + navigator.cookieEnabled );\r\n\r\n}\r\n\r\n/**\r\n * Default cookie is not saving settings\r\n * @param {any} name is not using\r\n */\r\nfunction defaultCookie( name ) {\r\n\r\n\t/**\r\n\t * Default cookie is not loading settings\r\n\t * @param {any} defaultValue\r\n\t * @returns defaultValue\r\n\t */\r\n\tthis.get = function ( defaultValue ) {\r\n\r\n\t\treturn defaultValue;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Default cookie is not saving settings\r\n\t */\r\n\tthis.set = function () {\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Default cookie is not loading objects\r\n\t * @param {string} name is not using\r\n\t * @param {any} options load an object from optionsDefault into options\r\n\t * @param {Object} optionsDefault source object\r\n\t */\r\n\tthis.getObject = function ( name, options, optionsDefault ) {\r\n\r\n\t\t// \r\n\t\tif ( !optionsDefault )\r\n\t\t\treturn;//object's settings is not saving\r\n\t\tObject.keys( optionsDefault ).forEach( function ( key ) {\r\n\r\n\t\t\toptions[key] = optionsDefault[key];\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * copy and returns an object from objectDefault\r\n\t * @param {string} name is not using\r\n\t * @param {any} objectDefault source object\r\n\t */\r\n\tthis.copyObject = function ( name, objectDefault ){\r\n\r\n\t\treturn JSON.parse( JSON.stringify( objectDefault ) );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Default cookie is not saving object's settings\r\n\t */\r\n\tthis.setObject = function () {\r\n\r\n\t};\r\n\r\n\tthis.isTrue = function ( defaultValue ) {\r\n\r\n\t\treturn defaultValue;\r\n\r\n\t};\r\n\r\n};\r\n","﻿/**\r\n * node.js version of the cookie.\r\n *\r\n * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/\r\n *\r\n * Copyright 2011 Data Arts Team, Google Creative Lab\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n */\r\nimport { set as setCookie, get as getCookie, getObject, copyObject, setObject, defaultCookie } from './index.js';\r\nvar cookie = {\r\n\r\n\tset: setCookie,\r\n\tsetObject: setObject,\r\n\tget: getCookie,\r\n\tgetObject: getObject,\r\n\tcopyObject: copyObject,\r\n\tdefaultCookie: defaultCookie,\r\n\r\n}\r\n\r\nexport default cookie;","﻿/**\r\n * myThreejs\r\n * \r\n * I use myThreejs in my projects for displaying of my 3D objects in the canvas.\r\n * \r\n * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/\r\n *\r\n * Copyright 2011 Data Arts Team, Google Creative Lab\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n */\r\n\r\n//Please download https://github.com/anhr/dat.gui/tree/CustomController to '../../../../My documents/MyProjects/webgl/three.js/GitHub/dat.gui' folder\r\n//import { GUI, controllers } from '../../../../My documents/MyProjects/webgl/three.js/GitHub/dat.gui';\r\n\r\n//Please download https://github.com/anhr/loadScriptNodeJS into ../loadScriptNodeJS folder\r\nimport loadScript from '../loadScriptNodeJS/loadScript.js';\r\n\r\n//Please download https://github.com/anhr/loadFileNodeJS into ../loadFileNodeJS folder\r\nimport loadFile from '../loadFileNodeJS/loadFile.js';\r\n\r\n//https://threejs.org/docs/#manual/en/introduction/Import-via-modules\r\nimport {\r\n\r\n\tVector2,\r\n\tVector3,\r\n\tPerspectiveCamera,\r\n\tScene,\r\n\tColor,\r\n\tFog,\r\n\tWebGLRenderer,\r\n\tPointLight,\r\n\tGroup,\r\n\tAxesHelper,\r\n\tRaycaster,\r\n\tSpriteText,\r\n\r\n} from 'http://localhost/threejs/three.js/build/three.module.js';//'../../three.js/build/three.module.js';\r\n\r\n\r\nimport cookie from '../cookieNodeJS/cookie.js';\r\n//import cookie from 'https://raw.githack.com/anhr/cookieNodeJS/master/cookie.js';\r\n\r\nimport { getLanguageCode } from 'https://raw.githack.com/anhr/commonNodeJS/master/lang.js';\r\n\r\n//import OrbitControlsGui from '../cookieNodeJS/OrbitControlsGui.js';\r\n//import OrbitControlsGui from '../commonNodeJS/OrbitControlsGui.js';\r\n//import OrbitControlsGui from 'http://localhost/threejs/nodejs/commonNodeJS/OrbitControlsGui.js';\r\n//import OrbitControlsGui from 'https://raw.githack.com/anhr/commonNodeJS/master/OrbitControlsGui.js';\r\n\r\nvar debug = true,\r\n\turl = 'localhost/threejs',//'192.168.1.2'//ATTENTION!!! localhost is not available for debugging of the mobile devices\r\n\tmin = '';//min.\r\n\r\nfunction arrayContainersF(){\r\n\r\n\tvar array = [];\r\n\tthis.push = function ( elContainer ) {\r\n\r\n\t\tarray.push( elContainer );\r\n\r\n\t};\r\n\tthis.display = function ( elContainer, fullScreen ) {\r\n\r\n\t\t//console.log( 'onFullScreen( ' + fullScreen + ')' );\r\n\t\tarray.forEach( function ( itemElContainer ) {\r\n\r\n\t\t\titemElContainer.style.display = ( itemElContainer === elContainer ) || ! fullScreen ? 'block' : 'none';\r\n\t\t\t//console.log( 'itemElContainer.id = ' + itemElContainer.id + ' itemElContainer.style.display = ' + itemElContainer.style.display );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n};\r\nvar arrayContainers = new arrayContainersF();\r\n\r\n/*\r\n * if you asynhronous creates two or more myThreejs same time, then you will receive the error message:\r\n * \r\n * Uncaught ReferenceError: WEBGL is not defined\r\n * \r\n * For resolving of the issue I have remembers myThreejs parameters in the arrayCreates\r\n * and creates next myThreejs only after creating of previous myThreejs.\r\n */\r\nvar arrayCreates = [];\r\n\r\n/**\r\n * @callback create3Dobjects\r\n * @param {Group} group group of my 3d objects. https://threejs.org/docs/index.html#api/en/objects/Group\r\n */\r\n\r\n/**\r\n * Creates new canvas with my 3D objects\r\n * @param {any} THREE\r\n * @param {create3Dobjects} create3Dobjects callback creates my 3D objects.\r\n * @param {object} [options] followed options is available:\r\n * @param {HTMLElement|string} [options.elContainer] If an HTMLElement, then a HTMLElement, contains a canvas and HTMLElement with id=\"iframe-goes-in-here\" for gui.\r\n * If a string, then is id of the HTMLElement.\r\n * Default is document.getElementById( \"containerDSE\" ) or a div element, child of body.\r\n * @param {any} [options.orbitControls] use orbit controls allow the camera to orbit around a target. https://threejs.org/docs/index.html#examples/en/controls/OrbitControls\r\n * @param {boolean} [options.orbitControlsGui] true - displays the orbit controls gui.\r\n * Available only if options.orbitControls is defined. Default is false.\r\n * @param {Object} [options.stereoEffect] use stereoEffect.\r\n * @param {Object} [options.stereoEffect.StereoEffect] https://github.com/anhr/three.js/blob/dev/examples/js/effects/StereoEffect.js\r\n * @param {Object} [options.stereoEffect.spatialMultiplexsIndexs] https://en.wikipedia.org/wiki/DVB_3D-TV\r\n * @param {boolean} [options.dat] true - use dat-gui JavaScript Controller Library. https://github.com/dataarts/dat.gui\r\n * @param {boolean} [options.controllerPlay] true - use PlayController https://github.com/anhr/controllerPlay. My custom controller in my version of dat.gui https://github.com/anhr/dat.gui for playing of 3D obects in my projects.\r\n * Available only if options.dat = true\r\n * @param {boolean} [options.menuPlay] true - use my dropdown menu for canvas in my version of [dat.gui](https://github.com/anhr/dat.gui) for playing of 3D obects in my projects.\r\n * See nodejs\\menuPlay\\index.js\r\n * @param {object} [options.canvas] canvas properties\r\n * @param {number} [options.canvas.width] width of the canvas\r\n * @param {number} [options.canvas.height] height of the canvas\r\n * @param {object} [options.axesHelper] axesHelper options\r\n * @param {object} [options.axesHelper.scales] axes scales. See three.js\\src\\helpers\\AxesHelper.js\r\n * @param {object} [options.t] time options\r\n * @todo If you want to use raycaster (working out what objects in the 3d space the mouse is over) https://threejs.org/docs/index.html#api/en/core/Raycaster,\r\n * please add following object into your 3D Object userdata:\r\n * your3dObject.userData.raycaster = {\r\n\r\n\t\tonIntersection: function ( raycaster, intersection, scene, INTERSECTED ) {\r\n\r\n\t\t\t//Mouse is over of your 3D object event\r\n\t\t\t//TO DO something\r\n\t\t\t//For example you can use\r\n\t\t\tmyThreejs.addSpriteTextIntersection( raycaster, intersection, scene );\r\n\t\t\t//for displaying of the position of your 3D object\r\n\t\t\t//ATTENTION!!! Use onIntersection and onIntersectionOut togethe!\r\n\r\n\t\t},\r\n\t\tonIntersectionOut: function ( scene, INTERSECTED ) {\r\n\r\n\t\t\t//Mouse is out of your 3D object event\r\n\t\t\t//TO DO something\r\n\t\t\t//For example you can use\r\n\t\t\tmyThreejs.removeSpriteTextIntersection( scene );\r\n\t\t\t//for hide of the position of your 3D object that was displayed in onIntersection\r\n\t\t\t//ATTENTION!!! Use onIntersection and onIntersectionOut togethe!\r\n\r\n\t\t},\r\n\t\tonMouseDown: function ( raycaster, intersection, scene ) {\r\n\r\n\t\t\t//User has clicked over your 3D object\r\n\t\t\t//TO DO something\r\n\t\t\t//For example:\r\n\t\t\tvar position = raycaster.stereo.getPosition( intersection );\r\n\t\t\talert( 'You are clicked the \"' + intersection.object.type + '\" type object.'\r\n\t\t\t\t+ ( intersection.index === undefined ? '' : ' Index = ' + intersection.index + '.' )\r\n\t\t\t\t+ ' Position( x: ' + position.x + ', y: ' + position.y + ', z: ' + position.z + ' )' );\r\n\r\n\t\t},\r\n\r\n\t}\r\n * Example: https://raw.githack.com/anhr/controllerPlay/master/Examples/html/\r\n */\r\nexport function create( create3Dobjects, options ) {\r\n\r\n\t//console.log( 'myThreejs.create(...)' );\r\n\r\n\tarrayCreates.push( {\r\n\r\n\t\tcreate3Dobjects: create3Dobjects,\r\n\t\toptions: options,\r\n\r\n\t} );\r\n\tif ( arrayCreates.length > 1 )\r\n\t\treturn;\r\n\r\n\toptions = options || {};\r\n\toptions.scale = 1;\r\n\r\n\tfunction onloadScripts() {\r\n\r\n//console.log( 'onloadScripts()' );\r\n/*\r\n\t\tif ( THREE.WEBGL.isWebGLAvailable() === false ) {\r\n\r\n\t\t\tdocument.body.appendChild( WEBGL.getWebGLErrorMessage() );\r\n\t\t\talert( WEBGL.getWebGLErrorMessage().innerHTML );\r\n\r\n\t\t}\r\n*/\r\n\t\tvar elContainer = options.elContainer === undefined ? document.getElementById( \"containerDSE\" ) :\r\n\t\t\ttypeof options.elContainer === \"string\" ? document.getElementById( options.elContainer ) : options.elContainer;\r\n\t\tif ( elContainer === null ) {\r\n\r\n\t\t\telContainer = document.createElement( 'div' );\r\n\t\t\tdocument.querySelector( 'body' ).appendChild( elContainer );\r\n\r\n\t\t}\r\n\t\t//elContainer.innerHTML = '<img src=\"https://raw.githubusercontent.com/anhr/TreeElementNodeJS/master/img/wait.gif\">';\r\n\t\tarrayContainers.push( elContainer );\r\n\t\telContainer.innerHTML = loadFile.sync( 'https://raw.githack.com/anhr/myThreejs/master/canvasContainer.html' );//'http://' + url + '/nodejs/myThreejs/canvasContainer.html'\r\n\t\telContainer = elContainer.querySelector( '.container' );\r\n\t\tvar elCanvas = elContainer.querySelector( 'canvas' );\r\n\r\n\t\tvar camera, defaultCameraPosition = new Vector3( 0.4, 0.4, 2 ), scene, renderer, controls, stereoEffect, group, playController,\r\n\t\t\tcanvasMenu, raycaster, INTERSECTED = [], scale = options.scale, axesHelper, colorsHelper = 0x80;//, cubeType = 'cube', spriteTextIntersection, dotLines = new dotLines()\r\n\r\n\t\t//for raycaster\r\n\r\n\t\tvar mouse = new Vector2(),\r\n//\t\t\tparticles = [],\r\n\t\t\tintersects;\r\n\t\telCanvas.addEventListener( 'mousemove', onDocumentMouseMove, false );\r\n\t\telCanvas.addEventListener( 'mousedown', onDocumentMouseDown, false );\r\n\r\n\t\tinit();\r\n\t\tanimate();\r\n\r\n\t\tfunction init() {\r\n\r\n\t\t\t// CAMERA\r\n\r\n\t\t\tcamera = new PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.01, 10 );\r\n\t\t\tcamera.position.copy( defaultCameraPosition );\r\n//\t\t\tcamera.position.set( 0.4, 0.4, 2 );\r\n\r\n\t\t\t// SCENE\r\n\r\n\t\t\tscene = new Scene();\r\n\t\t\tscene.background = new Color( 0x000000 );\r\n\t\t\tscene.fog = new Fog( 0x000000, 250, 1400 );\r\n\r\n\t\t\t//\r\n\r\n\t\t\trenderer = new WebGLRenderer( {\r\n\r\n\t\t\t\tantialias: true,\r\n\t\t\t\tcanvas: elCanvas,\r\n\r\n\t\t\t} );\r\n\t\t\trenderer.setPixelRatio( window.devicePixelRatio );\r\n\r\n\t\t\t//resize\r\n\t\t\trenderer.setSizeOld = renderer.setSize;\r\n\t\t\trenderer.setSize = function ( width, height, updateStyle ) {\r\n\r\n\t\t\t\trenderer.setSizeOld( width, height, updateStyle );\r\n\r\n\t\t\t\ttimeoutControls = setTimeout( function () {\r\n\r\n\t\t\t\t\telContainer.style.height = elCanvas.style.height;//height + \"px\";\r\n\t\t\t\t\telContainer.style.width = elCanvas.style.width;//width + \"px\";\r\n\t\t\t\t\telContainer.style.left = elCanvas.style.left;\r\n\t\t\t\t\telContainer.style.top = elCanvas.style.top;\r\n\t\t\t\t\telContainer.style.position = elCanvas.style.position;\r\n\r\n//\t\t\t\t\tif ( typeof menuPlay !== 'undefined' )\r\n\t\t\t\t\tif ( canvasMenu !== undefined )\r\n\t\t\t\t\t\tcanvasMenu.setSize( width, height );\r\n\r\n\t\t\t\t}, 0 );\r\n\r\n\t\t\t};\r\n\t\t\t//\t\t\trenderer.setSize( window.innerWidth / 2, window.innerHeight / 2 );\r\n\t\t\trenderer.setSize( ( options.canvas !== undefined ) && (options.canvas.width !== undefined ) ? options.canvas.width : elCanvas.clientWidth,\r\n\t\t\t\t( options.canvas !== undefined ) && ( options.canvas.height !== undefined ) ? options.canvas.height : elCanvas.clientHeight );\r\n\r\n\t\t\t//StereoEffect. https://github.com/anhr/three.js/blob/dev/examples/js/effects/StereoEffect.js\r\n\t\t\t//if ( THREE.StereoEffect !== undefined )\r\n\t\t\tif ( options.stereoEffect ){\r\n\r\n\t\t\t\tstereoEffect = new options.stereoEffect.StereoEffect( renderer, {\r\n\r\n\t\t\t\t\tspatialMultiplex: options.stereoEffect.spatialMultiplexsIndexs.Mono, //.SbS,\r\n\t\t\t\t\tfar: camera.far,\r\n\t\t\t\t\tcamera: camera,\r\n\t\t\t\t\tstereoAspect: 1,\r\n\t\t\t\t\tcookie: cookie,\r\n\t\t\t\t\telParent: elCanvas.parentElement,\r\n\r\n\t\t\t\t} );\r\n\t\t\t\tstereoEffect.options.spatialMultiplex = options.stereoEffect.spatialMultiplexsIndexs.Mono;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//Light\r\n\r\n\t\t\tvar light = new PointLight( 0xffffff, 1 );\r\n\t\t\tlight.position.copy( new Vector3( 1, 1, 1 ) );\r\n\t\t\tscene.add( light );\r\n\r\n\t\t\tlight = new PointLight( 0xffffff, 1 );\r\n\t\t\tlight.position.copy( new Vector3( -2, -2, -2 ) );\r\n\t\t\tscene.add( light );\r\n\r\n\t\t\tgroup = new Group();\r\n\t\t\tscene.add( group );\r\n\r\n\t\t\t//dat-gui JavaScript Controller Library\r\n\t\t\t//https://github.com/dataarts/dat.gui\r\n//\t\t\tif ( typeof dat !== 'undefined' )\r\n\t\t\tif ( options.dat && ( options.controllerPlay || options.stereoEffect )){\r\n\r\n\t\t\t\tvar gui = new dat.GUI( {\r\n\r\n\t\t\t\t\tautoPlace: false,\r\n\t\t\t\t\t//\t\t\tclosed: true,//Icorrect \"Open Controls\" button name\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t\t//Close gui window\r\n\t\t\t\tif ( gui.__closeButton.click !== undefined )//for compatibility with Safari 5.1.7 for Windows\r\n\t\t\t\t\tgui.__closeButton.click();\r\n\r\n\t\t\t\t//Thanks to https://stackoverflow.com/questions/41404643/place-dat-gui-strictly-inside-three-js-scene-without-iframe\r\n\t\t\t\telContainer.querySelector( '#my-gui-container' ).appendChild( gui.domElement );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcreate3Dobjects( group );\r\n\r\n\t\t\t//PlayController https://github.com/anhr/controllerPlay. My custom controller in my version of dat.gui https://github.com/anhr/dat.gui for playing of 3D obects in my projects.\r\n\t\t\t//\t\t\t\tif ( typeof controllerPlay !== \"undefined\" )\r\n\t\t\tif ( options.controllerPlay ) {\r\n\r\n\t\t\t\tvar colorRed = new Color( 0xff0000 );\r\n\t\t\t\tplayController = controllerPlay.create( group, {\r\n\r\n\t\t\t\t\tonShowObject3D: function ( objects3DItem, index ) {\r\n\r\n\t\t\t\t\t\tobjects3DItem.visible = true;\r\n\t\t\t\t\t\tif ( canvasMenu !== undefined )\r\n\t\t\t\t\t\t\tcanvasMenu.setIndex( index );\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonHideObject3D: function ( objects3DItem ) {\r\n\r\n\t\t\t\t\t\tobjects3DItem.visible = false;//hide object3D\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonSelectedObject3D: function ( objects3DItem, index ) {\r\n\r\n\t\t\t\t\t\tobjects3DItem.material.color = colorRed;\r\n\t\t\t\t\t\tobjects3DItem.visible = true;\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\tif ( typeof menuPlay !== \"undefined\" )\r\n\t\t\t\t\t\tif ( canvasMenu !== undefined )\r\n\t\t\t\t\t\t\tcanvasMenu.setIndex( index );\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonRestoreObject3D: function ( objects3DItem ) {\r\n\r\n\t\t\t\t\t\tobjects3DItem.material.color = objects3DItem.userData.color;\r\n\t\t\t\t\t\tobjects3DItem.visible = true;\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonRenamePlayButton: function ( name, title ) {\r\n\r\n\t\t\t\t\t\tvar elMenuButtonPlay = document.getElementById( 'menuButtonPlay' );\r\n\t\t\t\t\t\tif ( elMenuButtonPlay === null )\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\telMenuButtonPlay.innerHTML = name;\r\n\t\t\t\t\t\telMenuButtonPlay.title = title;\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonRenameRepeatButton: function ( title, color ) {\r\n\r\n\t\t\t\t\t\tvar elMenuButtonRepeat = document.getElementById( 'menuButtonRepeat' );\r\n\t\t\t\t\t\tif ( elMenuButtonRepeat === null )\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t//\t\t\t\t\telMenuButtonRepeat.innerHTML = name;\r\n\t\t\t\t\t\telMenuButtonRepeat.title = title;\r\n\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t} );\r\n\t\t\t\tif ( gui !== undefined )\r\n\t\t\t\t\tgui.add( playController );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( ( stereoEffect !== undefined ) && ( typeof gui !== 'undefined' ) )\r\n\r\n\t\t\t\tvar spatialMultiplexsIndexs = options.stereoEffect.spatialMultiplexsIndexs;\r\n\t\t\t\tstereoEffect.gui( gui, {\r\n\r\n\t\t\t\t\tgetLanguageCode: getLanguageCode,\r\n\t\t\t\t\tgui: gui,\r\n\t\t\t\t\tstereoEffect: stereoEffect,\r\n\t\t\t\t\tonChangeMode: function ( mode ) {\r\n\r\n\t\t\t\t\t\tvar fullScreen = true;;\r\n\t\t\t\t\t\tswitch ( mode ) {\r\n\r\n\t\t\t\t\t\t\tcase spatialMultiplexsIndexs.Mono:\r\n\t\t\t\t\t\t\t\tfullScreen = false;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase spatialMultiplexsIndexs.SbS:\r\n\t\t\t\t\t\t\tcase spatialMultiplexsIndexs.TaB:\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault: console.error( 'myThreejs: Invalid spatialMultiplexIndex = ' + mode );\r\n\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\trendererSizeDefault.onFullScreenToggle( !fullScreen );\r\n\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\tif ( options.menuPlay ) {\r\n\r\n\r\n\t\t\t\tcanvasMenu = new menuPlay.create( elContainer, {\r\n\r\n\t\t\t\t\tstereoEffect: { stereoEffect: stereoEffect, spatialMultiplexsIndexs: options.stereoEffect.spatialMultiplexsIndexs },\r\n\t\t\t\t\tplayController: playController,\r\n\t\t\t\t\tonFullScreenToggle: function () {\r\n\r\n\t\t\t\t\t\treturn rendererSizeDefault.onFullScreenToggle();\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonFullScreen: function ( fullScreen, elContainer ) {\r\n\r\n\t\t\t\t\t\trendererSizeDefault.onFullScreenToggle( !fullScreen );\r\n\t\t\t\t\t\t//\t\t\t\t\t\tarrayContainers.display( elContainer.parentElement, fullScreen );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\t\t\t\toptions.canvasMenu = canvasMenu;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//use orbit controls allow the camera to orbit around a target. https://threejs.org/docs/index.html#examples/en/controls/OrbitControls\r\n\t\t\t//if ( THREE.OrbitControls !== undefined )\r\n\t\t\tif ( options.orbitControls ) {\r\n\r\n\t\t\t\tcontrols = new options.orbitControls( camera, renderer.domElement );\r\n\t\t\t\t//\t\t\t\tcontrols.target.set( 0, 0, 0 );\r\n\t\t\t\tcontrols.target.set( scene.position.x * 2, scene.position.y * 2, scene.position.z * 2 );\r\n\t\t\t\tcontrols.update();\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// helper\r\n\r\n\t\t\tif ( options.axesHelper ) {\r\n\r\n\t\t\t\taxesHelper = new AxesHelper( 1 * scale, {\r\n\t\t\t\t\tcookie: cookie,\r\n\t\t\t\t\tscene: scene,\r\n\t\t\t\t\tnegativeAxes: true,\r\n\t\t\t\t\tcolors: colorsHelper / 0xff, //gray axes\r\n\t\t\t\t\tcolorsHelper: colorsHelper,\r\n\t\t\t\t\t//controls: controls,\r\n\t\t\t\t\t//camera: camera,\r\n\t\t\t\t\tscales: options.axesHelper.scales,\r\n\t\t\t\t} );\r\n\t\t\t\tscene.add( axesHelper );\r\n\r\n\t\t\t\tif ( controls !== undefined )\r\n\t\t\t\t\tcontrols.update();//if scale != 1 and position != 0 of the screen, то после открытия canvas положение картинки смещено. Положение восстанавливается только если подвигать мышью\r\n\r\n\t\t\t\taxesHelper.gui( gui, {\r\n\r\n\t\t\t\t\tgetLanguageCode: getLanguageCode,\r\n\t\t\t\t\tcookie: cookie,\r\n\t\t\t\t\tlang: {\r\n\r\n\t\t\t\t\t\tlanguageCode: 'ru',\r\n\r\n\t\t\t\t\t\taxesHelper: 'Оси координат', //'Axes Helper'\r\n\r\n\t\t\t\t\t\tnegativeAxes: 'Минусовые оси',\r\n\t\t\t\t\t\tnegativeAxesTitle: 'Отображать отрицательные оси.',\r\n\r\n\t\t\t\t\t\tscales: 'Шкалы',\r\n\r\n\t\t\t\t\t\tdisplayScales: 'Показать',\r\n\t\t\t\t\t\tdisplayScalesTitle: 'Показать или скрыть шкалы осей координат.',\r\n\r\n\t\t\t\t\t\tmin: 'Минимум',\r\n\t\t\t\t\t\tmax: 'Максимум',\r\n\r\n\t\t\t\t\t\tmarks: 'Риски',\r\n\t\t\t\t\t\tmarksTitle: 'Количество отметок на шкале',\r\n\r\n\t\t\t\t\t\tdefaultButton: 'Восстановить',\r\n\t\t\t\t\t\tdefaultTitle: 'Восстановить настройки осей координат по умолчанию.',\r\n\r\n\t\t\t\t\t\t//Zoom\r\n\t\t\t\t\t\tzoom: 'Масштаб',\r\n\t\t\t\t\t\tin: 'увеличить',\r\n\t\t\t\t\t\tout: 'уменьшить',\r\n\t\t\t\t\t\twheelZoom: 'Прокрутите колесико мыши для изменения масштаба',\r\n\r\n\t\t\t\t\t\t//Position\r\n\t\t\t\t\t\toffset: 'Сдвиг',\r\n\t\t\t\t\t\tadd: 'добавить',\r\n\t\t\t\t\t\tsubtract: 'вычесть',\r\n\t\t\t\t\t\twheelPosition: 'Прокрутите колесико мыши для изменения позиции',\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//OrbitControls gui\r\n\t\t\tif ( gui !== undefined ) {\r\n\r\n\t\t\t\tif ( options.orbitControlsGui === true )\r\n\t\t\t\t\tOrbitControlsGui( gui, controls, {\r\n\r\n\t\t\t\t\t\tgetLanguageCode: getLanguageCode,\r\n\t\t\t\t\t\tscales: options.axesHelper.scales,\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t//default button\r\n\t\t\t\tdat.controllerNameAndTitle( gui.add( {\r\n\t\t\t\t\tdefaultF: function ( value ) {\r\n\r\n\t\t\t\t\t\tcontrols.target = new Vector3();\r\n\t\t\t\t\t\tcamera.position.copy( defaultCameraPosition );\r\n\t\t\t\t\t\tcontrols.object.position.copy( camera.position );\r\n\t\t\t\t\t\tcontrols.update();\r\n\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t}, 'defaultF' ), lang.defaultButton, lang.defaultTitle );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//raycaster\r\n\r\n\t\t\tgroup.children.forEach( function ( item ) {\r\n\r\n\t\t\t\tif ( item.userData.raycaster !== undefined ) {\r\n\r\n\t\t\t\t\tif ( raycaster === undefined ) {\r\n\r\n\t\t\t\t\t\traycaster = new Raycaster();\r\n\t\t\t\t\t\traycaster.params.Points.threshold = item.material.size / 3;//0.03;\r\n\t\t\t\t\t\traycaster.setStereoEffect( {\r\n\r\n\t\t\t\t\t\t\trenderer: renderer,\r\n\t\t\t\t\t\t\tcamera: camera,\r\n\t\t\t\t\t\t\tstereoEffect: stereoEffect,\r\n\t\t\t\t\t\t\tonIntersection: function ( intersects ) {\r\n\r\n/*\r\nif ( intersects.length > 1 )\r\n\tconsole.warn( 'intersects.length > 1' );\r\n\t\t\t\t\t\t\t\tvar intersection = intersects[0];\r\n\t\t\t\t\t\t\t\tif ( intersection.object.userData.raycaster !== undefined ) {\r\n\r\n\t\t\t\t\t\t\t\t\tintersection.object.userData.raycaster.onIntersection( raycaster, intersection, scene, INTERSECTED );\r\n\t\t\t\t\t\t\t\t\tINTERSECTED = intersection.object;\r\n\r\n\t\t\t\t\t\t\t\t}\r\n*/\r\n\t\t\t\t\t\t\t\tintersects.forEach( function ( intersection ) {\r\n\r\n\t\t\t\t\t\t\t\t\tif ( intersection.object.userData.raycaster !== undefined ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tintersection.object.userData.raycaster.onIntersection( raycaster, intersection, scene, intersection.object );\r\n\t\t\t\t\t\t\t\t\t\tINTERSECTED.push( intersection.object );\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tonIntersectionOut: function ( intersects ) {\r\n\r\n\r\n//console.warn( 'intersects.length > 0' );\r\n/*\r\n\t\t\t\t\t\t\t\tintersects.forEach( function ( intersection ) {\r\n\r\n\t\t\t\t\t\t\t\t\tintersection.userData.raycaster.onIntersectionOut( scene, intersection );\r\n\r\n\t\t\t\t\t\t\t\t} );\r\n*/\r\n//\t\t\t\t\t\t\t\tif ( INTERSECTED === undefined )\r\n\t\t\t\t\t\t\t\tif ( INTERSECTED.length === 0 )\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\tINTERSECTED.forEach( function ( intersection ) {\r\n\r\n\t\t\t\t\t\t\t\t\tintersection.userData.raycaster.onIntersectionOut( scene, intersection );\r\n\r\n\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\twhile ( INTERSECTED.length > 0 )\r\n\t\t\t\t\t\t\t\t\tINTERSECTED.pop();\r\n/*\r\n\t\t\t\t\t\t\t\tINTERSECTED.userData.raycaster.onIntersectionOut( scene, INTERSECTED );\r\n\t\t\t\t\t\t\t\tINTERSECTED = undefined;\r\n*/\r\n\r\n\t\t\t\t\t\t\t\t//\t\t\t\t\tonIntersectionOut( intersects );\r\n\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tonMouseDown: function ( intersects ) {\r\n\r\n\t\t\t\t\t\t\t\tvar intersection = intersects[0];\r\n\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\t( intersection.object.userData.raycaster !== undefined )\r\n\t\t\t\t\t\t\t\t\t&& ( intersection.object.userData.raycaster.onMouseDown !== undefined ) ) {\r\n\r\n\t\t\t\t\t\t\t\t\tintersection.object.userData.raycaster.onMouseDown( raycaster, intersection, scene );\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif ( intersection.object.type === \"Points\" ) {\r\n\r\n\t\t\t\t\t\t\t\t\t//\t\t\t\t\t\t\t\t\tdotLines.dottedLines( raycaster.stereo.getPosition( intersection, true ) );\r\n\t\t\t\t\t\t\t\t\taxesHelper.exposePosition( raycaster.stereo.getPosition( intersection, true ) );\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\traycaster.stereo.addParticle( item );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tfunction getRendererSize() {\r\n\r\n\t\t\t\tvar style = {\r\n\r\n\t\t\t\t\tposition: renderer.domElement.style.position,\r\n\t\t\t\t\tleft: renderer.domElement.style.left,\r\n\t\t\t\t\ttop: renderer.domElement.style.top,\r\n\t\t\t\t\twidth: renderer.domElement.style.width,\r\n\t\t\t\t\theight: renderer.domElement.style.height,\r\n\r\n\t\t\t\t},\r\n\t\t\t\t\tsizeOriginal = new Vector2();\r\n\t\t\t\trenderer.getSize( sizeOriginal );\r\n\t\t\t\treturn {\r\n\r\n\t\t\t\t\tonFullScreenToggle: function ( fullScreen ) {\r\n\r\n\t\t\t\t\t\tvar size = new Vector2();\r\n\t\t\t\t\t\trenderer.getSize( size );\r\n\t\t\t\t\t\tif ( fullScreen === undefined )\r\n\t\t\t\t\t\t\tfullScreen = ( size.x === window.innerWidth ) && ( size.y === window.innerHeight );\r\n\t\t\t\t\t\tif ( fullScreen ) {\r\n\r\n\t\t\t\t\t\t\t//restore size of the canvas\r\n\t\t\t\t\t\t\trenderer.setSize( sizeOriginal.x, sizeOriginal.y );\r\n\t\t\t\t\t\t\trenderer.domElement.style.position = style.position;\r\n\t\t\t\t\t\t\trenderer.domElement.style.left = style.left;\r\n\t\t\t\t\t\t\trenderer.domElement.style.top = style.top;\r\n\t\t\t\t\t\t\trenderer.domElement.style.width = style.width;\r\n\t\t\t\t\t\t\trenderer.domElement.style.height = style.height;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t//Full screen of the canvas\r\n\t\t\t\t\t\t\trenderer.setSize( window.innerWidth, window.innerHeight );\r\n\t\t\t\t\t\t\trenderer.domElement.style.position = 'fixed';\r\n\t\t\t\t\t\t\trenderer.domElement.style.left = 0;\r\n\t\t\t\t\t\t\trenderer.domElement.style.top = 0;\r\n\t\t\t\t\t\t\trenderer.domElement.style.width = '100%';\r\n\t\t\t\t\t\t\trenderer.domElement.style.height = '100%';\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tcamera.aspect = size.x / size.y;\r\n\t\t\t\t\t\tcamera.updateProjectionMatrix();\r\n\r\n\t\t\t\t\t\tfullScreen = !fullScreen;\r\n\t\t\t\t\t\tarrayContainers.display( elContainer.parentElement, fullScreen );\r\n\t\t\t\t\t\tif ( canvasMenu !== undefined )\r\n\t\t\t\t\t\t\tcanvasMenu.setFullScreenButton( fullScreen );\r\n\r\n\t\t\t\t\t\treturn fullScreen;\r\n\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t};\r\n\t\t\tvar rendererSizeDefault = getRendererSize();\r\n\r\n\t\t\twindow.addEventListener( 'resize', onResize, false );\r\n\r\n\t\t}\r\n\t\tfunction onResize() {\r\n\r\n\t\t\tvar size = new Vector2();\r\n\t\t\trenderer.getSize( size );\r\n\t\t\tcamera.aspect = size.x / size.y;\r\n\t\t\tcamera.updateProjectionMatrix();\r\n\r\n\t\t\tif ( typeof se === 'undefined' )\r\n\t\t\t\trenderer.setSize( size.x, size.y );\r\n\t\t\telse\r\n\t\t\t\tstereoEffect.setSize( size.x, size.y );\r\n\r\n\t\t}\r\n\t\tfunction onDocumentMouseMove( event ) {\r\n\t\t\tif ( raycaster.stereo !== undefined )\r\n\t\t\t\traycaster.stereo.onDocumentMouseMove( event );\r\n\t\t\telse {\r\n\r\n\t\t\t\t// Test of the old version of THREE.Raycaster\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tvar left = renderer.domElement.offsetLeft,\r\n\t\t\t\t\ttop = renderer.domElement.offsetTop,\r\n\t\t\t\t\tsize = new Vector2;\r\n\t\t\t\trenderer.getSize( size );\r\n\t\t\t\tmouse.x = ( event.clientX / size.x ) * 2 - 1 - ( left / size.x ) * 2;\r\n\t\t\t\tmouse.y = -( event.clientY / size.y ) * 2 + 1 + ( top / size.y ) * 2;\r\n\r\n\t\t\t}\r\n\t\t\tif ( event.buttons != 1 )\r\n\t\t\t\treturn;\r\n\r\n\t\t\trender();\r\n\r\n\t\t}\r\n\t\tfunction onDocumentMouseDown( event ) {\r\n\r\n\t\t\tif ( raycaster.stereo !== undefined )\r\n\t\t\t\traycaster.stereo.onDocumentMouseDown( event );\r\n\t\t\telse {\r\n\r\n\t\t\t\traycaster.setFromCamera( mouse, camera );\r\n\t\t\t\tintersects = raycaster.intersectObjects( particles );\r\n\t\t\t\tif ( intersects.length > 0 ) {\r\n\r\n\t\t\t\t\tvar intersection = intersects[0],\r\n\t\t\t\t\t\tposition = getPosition( intersection );\r\n\t\t\t\t\talert( 'You are clicked the \"' + intersection.object.type + '\" type object.'\r\n\t\t\t\t\t\t+ ( intersection.index === undefined ? '' : ' Index = ' + intersection.index + '.' )\r\n\t\t\t\t\t\t+ ' Position( x: ' + position.x + ', y: ' + position.y + ', z: ' + position.z + ' )' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction animate() {\r\n\r\n\t\t\trequestAnimationFrame( animate );\r\n\r\n\t\t\trender();\r\n\r\n\t\t}\r\n\r\n\t\tfunction render() {\r\n\r\n\t\t\t//console.log( 'elContainer.id = ' + elContainer.id )\r\n\t\t\tif ( typeof stereoEffect === 'undefined' )\r\n//\t\t\tif ( ! options.stereoEffect )\r\n\t\t\t\trenderer.render( scene, camera );\r\n\t\t\telse stereoEffect.render( scene, camera );\r\n\r\n\t\t\tif ( raycaster.stereo === undefined ) {\r\n\r\n\t\t\t\traycaster.setFromCamera( mouse, camera );\r\n\t\t\t\tintersects = raycaster.intersectObjects( group.children );//particles );\r\n\t\t\t\tif ( intersects.length > 0 )\r\n\t\t\t\t\tonIntersection( intersects );\r\n\t\t\t\telse onIntersectionOut( intersects );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar timeoutControls;\r\n\r\n\t\tarrayCreates.shift();\r\n\t\tvar params = arrayCreates.shift();\r\n\t\tif ( params === undefined )\r\n\t\t\treturn;\r\n\t\tcreate( params.create3Dobjects, params.options );\r\n\r\n\t}\r\n\r\n\tvar optionsStyle = {\r\n\r\n\t\t//style rel=\"stylesheet\"\r\n\t\ttag: 'style',\r\n/*\r\n\t\tonload: function ( response, url ) {\r\n\r\n\t\t\tconsole.log( 'loadScript.onload: ' + url );\r\n\r\n\t\t},\r\n*/\r\n\r\n\t}\r\n\r\n\tvar arrayScripts = [\r\n\t];\r\n/*\r\n\tif ( typeof THREE === 'undefined' ) {\r\n\r\n\t\tarrayScripts.push( debug ? \"http://\" + url + \"/threejs/three.js/build/three.js\" :\r\n\t\t\t\"https://raw.githack.com/anhr/three.js/dev/build/three.js\");\r\n\t\tarrayScripts.push( debug ? \"http://\" + url + \"/threejs/three.js/examples/js/WebGL.js\" :\r\n\t\t\t\"https://raw.githack.com/anhr/three.js/dev/examples/js/WebGL.js\" );\r\n\r\n\t}\r\n*/\r\n\tif ( options.menuPlay ) {\r\n\r\n\r\n\t\tarrayScripts.push( debug ? \"http://\" + url + \"/nodejs/menuPlay/build/menuPlay.js\" :\r\n\t\t\t\"https://raw.githack.com/anhr/menuPlay/master/build/menuPlay.\" + min + \"js\" );\r\n\t\t//arrayScripts.push( \"http://' + url + '/nodejs/menuPlay/build/menuPlay.\" + min + \"js\" );\r\n\t\t//arrayScripts.push( \"https://raw.githack.com/anhr/menuPlay/master/build/menuPlay.js\" );\r\n\t\t//arrayScripts.push( \"https://raw.githack.com/anhr/menuPlay/master/build/menuPlay.\" + min + \"js\" );\r\n\r\n\r\n\t}\r\n/*\r\n\tif ( options.orbitControls )\r\n\t\tarrayScripts.push( debug ? \"http://\" + url + \"/threejs/three.js/examples/js/controls/OrbitControls.js\" :\r\n\t\t\t\"https://raw.githack.com/anhr/three.js/dev/examples/js/controls/OrbitControls.js\" );\r\n*/\r\n\tif ( options.dat ) {\r\n\r\n\t\t//loadScript.sync( 'http://' + url + '/nodejs/dropdownMenu/styles/gui.css', optionsStyle );\r\n\t\tloadScript.sync( debug ? 'http://' + url + '/nodejs/dropdownMenu/styles/gui.css' :\r\n\t\t\t'https://raw.githack.com/anhr/DropdownMenu/master/styles/gui.css', optionsStyle );\r\n\r\n\t\t//for .container class\r\n\t\t//loadScript.sync( 'http://' + url + '/nodejs/dropdownMenu/styles/menu.css', optionsStyle );\r\n\t\tloadScript.sync( debug ? 'http://' + url + '/nodejs/dropdownMenu/styles/menu.css' :\r\n\t\t\t'https://raw.githack.com/anhr/DropdownMenu/master/styles/menu.css', optionsStyle );\r\n/*\r\n\t\t//arrayScripts.push( \"https://raw.githack.com/anhr/three.js/dev/examples/js/libs/dat.gui.js\" );\r\n\t\tarrayScripts.push( debug ? \"http://\" + url + \"/threejs/three.js/examples/js/libs/dat.gui.js\" :\r\n\t\t\t\"https://raw.githack.com/anhr/three.js/dev/examples/js/libs/dat.gui.\" + min + \"js\" );\r\n*/\r\n\r\n\t}\r\n\r\n\tif ( options.controllerPlay ) {\r\n\r\n\t\t//arrayScripts.push( \"https://raw.githack.com/anhr/controllerPlay/master/build/controllerPlay.js\" );\r\n\t\tarrayScripts.push( debug ? \"http://\" + url + \"/nodejs/controllerPlay/build/controllerPlay.js\" :\r\n\t\t\t\"https://raw.githack.com/anhr/controllerPlay/master/build/controllerPlay.\" + min + \"js\" );\r\n\r\n\t}\r\n/*\r\n\tif ( options.stereoEffect ) {\r\n\r\n\t\tarrayScripts.push( debug ? \"http://\" + url + \"/threejs/three.js/examples/js/effects/StereoEffect.js\" :\r\n\t\t\t\"https://raw.githack.com/anhr/three.js/dev/examples/js/effects/StereoEffect.js\" );\r\n\r\n\t}\r\n*/\r\n\tif ( arrayScripts.length > 0 ) {\r\n\r\n\t\t//ATTENTION!!! If you use loadScript.sync, then you can not see some source code files during debugging.\r\n\t\tloadScript.async( arrayScripts, {\r\n\t\t\tonload: onloadScripts,\r\n\t\t\tonerror: function ( str, e ) {\r\n\r\n\t\t\t\tconsole.error( str );\r\n\r\n\t\t\t},\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\telse onloadScripts();\r\n\r\n}\r\nvar spriteTextIntersectionName = 'spriteTextIntersection';\r\nfunction findSpriteTextIntersection( scene ) {\r\n\r\n\tvar spriteTextIntersection;\r\n\tscene.children.forEach( function ( item ) {\r\n\r\n\t\tif ( ( item.type === \"Sprite\" ) && ( item.name === spriteTextIntersectionName ) ) {\r\n\r\n\t\t\t/*\r\n\t\t\t\t\t\t\t\t\tif ( spriteTextIntersection !== undefined )\r\n\t\t\t\t\t\t\t\t\t\tconsole.error( 'Duplucate spriteTextIntersection' );\r\n\t\t\t*/\r\n\t\t\tspriteTextIntersection = item;\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\treturn spriteTextIntersection;\r\n\r\n}\r\nexport function addSpriteTextIntersection( raycaster, intersection, scene ) {\r\n\r\n\tvar spriteTextIntersection = findSpriteTextIntersection( scene );\r\n\tif ( spriteTextIntersection !== undefined )\r\n\t\treturn;\r\n\tvar textColor = 'rgb( 128, 128, 128 )',\r\n\t\tposition = raycaster.stereo === undefined ? getPosition( intersection ) : raycaster.stereo.getPosition( intersection, true );\r\n\tif ( findSpriteTextIntersection( scene ) )\r\n\t\treturn;\r\n\tspriteTextIntersection = new SpriteText( 'x: ' + position.x + ' y: ' + position.y + ' z: ' + position.z, {\r\n\r\n\t\ttextHeight: 0.1,\r\n\t\tfontColor: textColor,\r\n\t\trect: {\r\n\r\n\t\t\tdisplayRect: true,\r\n\t\t\tborderThickness: 3,\r\n\t\t\tborderRadius: 10,\r\n\t\t\tborderColor: textColor,\r\n\t\t\tbackgroundColor: 'rgba( 0, 0, 0, 1 )',\r\n\r\n\t\t},\r\n\t\tposition: position.multiply( intersection.object.scale ),\r\n\t\tcenter: new Vector2( 0.5, 0 ),\r\n\r\n\t} );\r\n\tspriteTextIntersection.name = spriteTextIntersectionName;\r\n\tspriteTextIntersection.scale.divide( scene.scale );\r\n\tscene.add( spriteTextIntersection );\r\n/*\r\n\tloadScript.sync( debug ? \"http://\" + url + \"/threejs/three.js/src/objects/SpriteText.js\" :\r\n\t\t'https://raw.githubusercontent.com/anhr/three.js/dev/src/objects/SpriteText.js', {\r\n\r\n\t\tonload: function ( response ) {\r\n\r\n\t\t\tsetTimeout( function () {\r\n\r\n\t\t\t\tif ( findSpriteTextIntersection( scene ) )\r\n\t\t\t\t\treturn;\r\n\t\t\t\tspriteTextIntersection = new SpriteText( 'x: ' + position.x + ' y: ' + position.y + ' z: ' + position.z, {\r\n\r\n\t\t\t\t\ttextHeight: 0.1,\r\n\t\t\t\t\tfontColor: textColor,\r\n\t\t\t\t\trect: {\r\n\r\n\t\t\t\t\t\tdisplayRect: true,\r\n\t\t\t\t\t\tborderThickness: 3,\r\n\t\t\t\t\t\tborderRadius: 10,\r\n\t\t\t\t\t\tborderColor: textColor,\r\n\t\t\t\t\t\tbackgroundColor: 'rgba( 0, 0, 0, 1 )',\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tposition: position.multiply( intersection.object.scale ),\r\n\t\t\t\t\tcenter: new Vector2( 0.5, 0 ),\r\n\r\n\t\t\t\t} );\r\n\t\t\t\tspriteTextIntersection.name = spriteTextIntersectionName;\r\n\t\t\t\tspriteTextIntersection.scale.divide( scene.scale );\r\n\t\t\t\tscene.add( spriteTextIntersection );\r\n\t\t\t\t//\t\t\t\t\t\t\t\tINTERSECTED = intersection.object;\r\n\r\n\t\t\t}, 0 );\r\n\r\n\t\t},\r\n\t\tonerror: function ( str, e ) {\r\n\r\n\t\t\tconsole.error( str );\r\n\r\n\t\t},\r\n\r\n\t} );\r\n*/\r\n\r\n}\r\nexport function removeSpriteTextIntersection( scene ) {\r\n\r\n\tvar detected = false;\r\n\tdo {\r\n\r\n\t\tvar spriteTextIntersection = findSpriteTextIntersection( scene );\r\n\t\tif ( spriteTextIntersection !== undefined ) {\r\n\r\n\t\t\tscene.remove( spriteTextIntersection );\r\n\t\t\tif ( detected )\r\n\t\t\t\tconsole.error( 'Duplicate spriteTextIntersection' );\r\n\t\t\tdetected = true;\r\n\r\n\t\t}\r\n\r\n\t} while ( spriteTextIntersection !== undefined )\r\n\r\n}\r\n\r\n//Localization\r\n\r\nvar lang = {\r\n\r\n\tdefaultButton: 'Default',\r\n\tdefaultTitle: 'Restore Orbit controls settings.',\r\n\r\n};\r\n\r\nswitch ( getLanguageCode() ) {\r\n\r\n\tcase 'ru'://Russian language\r\n\t\tlang.defaultButton = 'Восстановить';\r\n\t\tlang.defaultTitle = 'Восстановить положение осей координат по умолчанию.';\r\n\t\tbreak;\r\n\r\n}\r\n"],"names":["myRequest","options","loadXMLDoc","req","window","XMLHttpRequest","ActiveXObject","NewActiveXObject","e","XMLHttpRequestStart","onreadystatechange","async","XMLHttpRequestStop","onerror","event","url","XMLHttpRequestReStart","getUrl","params","open","timeout","ontimeout","timeout_id_SendReq","setTimeout","send","message","abort","ProcessReqChange","processStatus200","readyState","status","processStatus200Error","error","GetElementText","tagName","noDisplayErrorMessage","xmlhttp","responseXML","ErrorMessage","responseText","element","getElementsByTagName","length","text","i","textContent","data","navigator","appName","appVersion","sync","onload","response","request","log","src","appendTo","document","isScriptExists","Array","optionsItem","tag","str","item","script","setAttribute","innerHTML","loadFileSync","undefined","loadScriptBase","isrc","srcAsync","next","_onload","callback","name","createElement","attribute","value","appendChild","elParent","scripts","querySelectorAll","child","id","loadScript","loadFile","isEnabled","cookieEnabled","set","cookie_date","toString","Date","setTime","getTime","cookie","settings","toGMTString","console","setObject","object","JSON","stringify","get","defaultValue","results","match","unescape","getObject","optionsDefault","defaultCookie","copyObject","objectDefault","parse","consoleCookieEnabled","keys","forEach","key","isTrue","setCookie","getCookie","debug","min","arrayContainersF","array","push","elContainer","display","fullScreen","itemElContainer","style","arrayContainers","arrayCreates","create","create3Dobjects","scale","onloadScripts","getElementById","querySelector","elCanvas","camera","defaultCameraPosition","Vector3","scene","renderer","controls","stereoEffect","group","playController","canvasMenu","raycaster","INTERSECTED","axesHelper","colorsHelper","mouse","Vector2","addEventListener","onDocumentMouseMove","onDocumentMouseDown","init","PerspectiveCamera","innerWidth","innerHeight","position","copy","Scene","background","Color","fog","Fog","WebGLRenderer","setPixelRatio","devicePixelRatio","setSizeOld","setSize","width","height","updateStyle","left","top","canvas","clientWidth","clientHeight","StereoEffect","spatialMultiplexsIndexs","Mono","far","parentElement","spatialMultiplex","light","PointLight","add","Group","dat","controllerPlay","gui","GUI","__closeButton","click","domElement","colorRed","objects3DItem","index","visible","setIndex","material","color","userData","title","elMenuButtonPlay","elMenuButtonRepeat","getLanguageCode","mode","SbS","TaB","onFullScreenToggle","menuPlay","rendererSizeDefault","orbitControls","target","x","y","z","update","AxesHelper","scales","orbitControlsGui","OrbitControlsGui","controllerNameAndTitle","lang","defaultButton","defaultTitle","children","Raycaster","Points","threshold","size","setStereoEffect","intersects","intersection","onIntersection","onIntersectionOut","pop","onMouseDown","type","exposePosition","stereo","getPosition","addParticle","getRendererSize","sizeOriginal","getSize","aspect","updateProjectionMatrix","setFullScreenButton","onResize","se","preventDefault","offsetLeft","offsetTop","clientX","clientY","buttons","setFromCamera","intersectObjects","particles","animate","render","timeoutControls","shift","optionsStyle","arrayScripts","spriteTextIntersectionName","findSpriteTextIntersection","spriteTextIntersection","addSpriteTextIntersection","textColor","SpriteText","multiply","divide","removeSpriteTextIntersection","detected","remove"],"mappings":"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"}