/**
 * node.js version of the myThreejs
 *
 * I use myThreejs into my projects for displaying of my 3D objects in the canvas.
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("http://localhost/threejs/three.js/build/three.module.js"),require("https://raw.githack.com/anhr/commonNodeJS/master/lang.js")):"function"==typeof define&&define.amd?define(["exports","http://localhost/threejs/three.js/build/three.module.js","https://raw.githack.com/anhr/commonNodeJS/master/lang.js"],t):t(e.myThreejs={},e.THREE,e.lang_js)}(this,function(e,T,M){"use strict";function r(t){if(this.loadXMLDoc=function(){var e;if(window.XMLHttpRequest){if(!(e=new XMLHttpRequest))throw"new XMLHttpRequest() failed!"}else{if(!window.ActiveXObject)throw"myRequest.loadXMLDoc(...) failed!";if(!(e=this.NewActiveXObject()))throw"NewActiveXObject() failed!"}return e},this.NewActiveXObject=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}return a('This browser does not support XMLHttpRequest. Probably, your security settings do not allow Web sites to use ActiveX controls installed on your computer. Refresh your Web page to find out the current status of your Web page or enable the "Initialize and script ActiveX controls not marked as safe" and "Run Active X controls and plug-ins" of the Security settings of the Internet zone of your browser.'),null},this.XMLHttpRequestStart=function(e,t){this.XMLHttpRequestStop(),this.req.onreadystatechange=e,"onerror"in this.req&&(this.req.onerror=function(e){a("XMLHttpRequest error. url: "+this.url)}),this.XMLHttpRequestReStart(t)},this.getUrl=function(){return void 0!==this.url&&null!=this.url||(this.url="XMLHttpRequest.xml"),this.url+(this.params?this.params:"")},this.XMLHttpRequestReStart=function(e){try{if(void 0===e&&(e=!0),this.req.open("GET",this.getUrl(),e),e){"timeout"in this.req&&(this.req.timeout=9e4),"ontimeout"in this.req?this.req.ontimeout=function(){a("XMLHttpRequest timeout")}:(clearTimeout(this.timeout_id_SendReq),this.timeout_id_SendReq=setTimeout(function(){a("XMLHttpRequest timeout 2")},9e4))}this.req.send(null)}catch(e){a(e.message+" url: "+this.url)}},this.XMLHttpRequestStop=function(){null!=this.req&&this.req.abort()},this.ProcessReqChange=function(e){var t=this.req;switch(t.readyState){case 4:if("unknown"==typeof t.status)return consoleError('typeof XMLHttpRequest status == "unknown"'),!0;if(200==t.status)return clearTimeout(this.timeout_id_SendReq),e(this);a("Invalid XMLHttpRequest status : "+t.status+" url: "+this.url);break;case 1:case 2:case 3:break;case 0:default:throw"processReqChange(); req.readyState = "+t.readyState}return!0},this.processStatus200Error=function(){var e=this.GetElementText("error",!0);return!!e&&(a(e),!0)},this.GetElementText=function(e,t){var o=this.req;if(!o.responseXML)return 1!=t&&a("GetXMLElementText(xmlhttp, "+e+"); xmlhttp.responseXML is null.\nxmlhttp.responseText:\n"+o.responseText),null;var n=o.responseXML.getElementsByTagName(e);if(0==n.length)return 1!=t&&a('GetXMLElementText(xmlhttp, "'+e+'"); element.length == '+n.length),"";for(var r="",i=0;i<n.length;i++)if(void 0===n[i].textContent){if(void 0===n[i].text)return a("GetXMLElementText(xmlhttp, "+e+"); element["+i+"].text) == undefined"),"";""!=r&&(r+=" "),r+=n[i].text}else r+=n[i].textContent;return r},t.data)this.req=t.data.req,this.url=t.data.url,this.params=t.data.params;else try{this.req=this.loadXMLDoc()}catch(e){var o;return o=void 0===e.message?e:e.message,void a("Your browser is too old and is not compatible with our site.\n\n"+window.navigator.appName+" "+window.navigator.appVersion+"\n\n"+o)}function a(e){console.error(e),t.onerror(e)}this.req||consoleError("Invalid myRequest.req: "+this.req)}function a(t,o){(o=o||{}).onload=o.onload||function(){},o.onerror=o.onerror||function(){};var n,e=new r(o);return e.url=t,e.XMLHttpRequestStart(function(){e.ProcessReqChange(function(e){e.processStatus200Error()||(n=e.req.responseText,console.log("loadFile.sync.onload() "+t),o.onload(n,t))})},!1),n}function s(e,t){if(t.tag=t.tag||{},"string"==typeof t.tag)switch(t.tag){case"style":t.tag={name:"style",attribute:{name:"rel",value:"stylesheet"}};break;default:return void console.error("Invalid options.tag: "+t.tag)}t.tag.name=t.tag.name||"script";var o=document.createElement(t.tag.name);t.tag.attribute=t.tag.attribute||{},t.tag.attribute.name=t.tag.attribute.name||"type",t.tag.attribute.value=t.tag.attribute.value||"text/javascript",o.setAttribute(t.tag.attribute.name,t.tag.attribute.value),e(o),t.appendTo.appendChild(o)}function l(e,t){for(var o=e.querySelectorAll("script"),n=0;n<o.length;n++){if(o[n].id===t)return!0}return!1}var i={sync:function(t,o){if((o=o||{}).onload=o.onload||function(){},o.onerror=o.onerror||function(){},o.appendTo=o.appendTo||document.getElementsByTagName("head")[0],l(o.appendTo,t))o.onload();else if(t instanceof Array){for(var n,r={appendTo:o.appendTo,tag:o.tag,onload:function(e,t){console.log("loadScript.sync.onload: "+t)},onerror:function(e){o.onerror(e),n=e}},e=0;e<t.length;e++){var i=t[e];if(s(function(e){e.setAttribute("id",i),e.innerHTML=a(i,r)},r),void 0!==n)break}void 0===n&&o.onload()}else s(function(e){e.setAttribute("id",t),e.innerHTML=a(t,o)},o)},async:function(e,n){var r;function i(t){function o(){e instanceof Array&&r<e.length-1?i(e[++r]):n.onload()}l(n.appendTo,t,n.onload)?o():s(function(e){e.setAttribute("id",t),e.readyState&&!e.onload?e.onreadystatechange=function(){"complete"==e.readyState&&void 0!==n.onload&&n.onload(),"loaded"==e.readyState&&(setTimeout(n.onload,0),this.onreadystatechange=null)}:(e.onload=function(){console.log("loadScript.async.onload() "+t),void 0!==n.onload&&o()},e.onerror=function(e){var t='loadScript: "'+this.src+'" failed';void 0!==n.onerror&&n.onerror(t,e),console.error(t)}),e.src=t},n)}(n=n||{}).appendTo=n.appendTo||document.getElementsByTagName("head")[0],n.onload=n.onload||function(){},e instanceof Array?i(e[r=0]):i(e)}},j={sync:a};function n(){return navigator.cookieEnabled}function o(e,t,o){n()?(t=t.toString(),void 0===o&&(o=new Date).setTime(o.getTime()+31536e6),document.cookie=e+"="+t+("undefined"==typeof settings?"":settings)+"; expires="+o.toGMTString(),""===document.cookie&&console.error("document.cookie is empty")):d()}function c(e,t){if(n()){var o=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return o?unescape(o[2]):void 0===t?"":t}d()}function u(e,t){return JSON.parse(c(e,JSON.stringify(t)))}function d(){console.error("navigator.cookieEnabled = "+navigator.cookieEnabled)}function f(e){this.get=function(e){return e},this.set=function(){},this.getObject=function(e,t,o){o&&Object.keys(o).forEach(function(e){t[e]=o[e]})},this.copyObject=function(e,t){return JSON.parse(JSON.stringify(t))},this.setObject=function(){},this.isTrue=function(e){return e}}var q={set:o,setObject:function(e,t){o(e,JSON.stringify(t))},get:c,getObject:function(e,t,o){(new f).getObject(e,t,u(e,o))},copyObject:u,defaultCookie:f},p=!0,h="localhost/threejs",m="";var L=new function(){var n=[];this.push=function(e){n.push(e)},this.display=function(t,o){n.forEach(function(e){e.style.display=e!==t&&o?"none":"block"})}},P=[];var g="spriteTextIntersection";function y(e){var t;return e.children.forEach(function(e){"Sprite"!==e.type||e.name!==g||(t=e)}),t}var R={defaultButton:"Default",defaultTitle:"Restore Orbit controls settings."};switch(M.getLanguageCode()){case"ru":R.defaultButton="Восстановить",R.defaultTitle="Восстановить положение осей координат по умолчанию."}e.create=function t(S,E){if(P.push({create3Dobjects:S,options:E}),!(1<P.length)){(E=E||{}).scale=1;var e={tag:"style"},o=[];E.menuPlay&&o.push(p?"http://"+h+"/nodejs/menuPlay/build/menuPlay.js":"https://raw.githack.com/anhr/menuPlay/master/build/menuPlay."+m+"js"),E.dat&&(i.sync(p?"http://"+h+"/nodejs/dropdownMenu/styles/gui.css":"https://raw.githack.com/anhr/DropdownMenu/master/styles/gui.css",e),i.sync(p?"http://"+h+"/nodejs/dropdownMenu/styles/menu.css":"https://raw.githack.com/anhr/DropdownMenu/master/styles/menu.css",e)),E.controllerPlay&&o.push(p?"http://"+h+"/nodejs/controllerPlay/build/controllerPlay.js":"https://raw.githack.com/anhr/controllerPlay/master/build/controllerPlay."+m+"js"),0<o.length?i.async(o,{onload:n,onerror:function(e,t){console.error(e)}}):n()}function n(){var i=void 0===E.elContainer?document.getElementById("containerDSE"):"string"==typeof E.elContainer?document.getElementById(E.elContainer):E.elContainer;null===i&&(i=document.createElement("div"),document.querySelector("body").appendChild(i)),L.push(i),i.innerHTML=j.sync("https://raw.githack.com/anhr/myThreejs/master/canvasContainer.html");var a,s,l,c,u,d,f,p,h,m,n,g=(i=i.querySelector(".container")).querySelector("canvas"),y=new T.Vector3(.4,.4,2),v=[],w=E.scale,r=new T.Vector2;function b(){var e=new T.Vector2;l.getSize(e),a.aspect=e.x/e.y,a.updateProjectionMatrix(),"undefined"==typeof se?l.setSize(e.x,e.y):u.setSize(e.x,e.y)}function x(){void 0===u?l.render(s,a):u.render(s,a),void 0===h.stereo&&(h.setFromCamera(r,a),0<(n=h.intersectObjects(d.children)).length?onIntersection(n):onIntersectionOut(n))}g.addEventListener("mousemove",function(e){if(void 0!==h.stereo)h.stereo.onDocumentMouseMove(e);else{e.preventDefault();var t=l.domElement.offsetLeft,o=l.domElement.offsetTop,n=new T.Vector2;l.getSize(n),r.x=e.clientX/n.x*2-1-t/n.x*2,r.y=-e.clientY/n.y*2+1+o/n.y*2}1==e.buttons&&x()},!1),g.addEventListener("mousedown",function(e){if(void 0!==h.stereo)h.stereo.onDocumentMouseDown(e);else if(h.setFromCamera(r,a),0<(n=h.intersectObjects(particles)).length){var t=n[0],o=getPosition(t);alert('You are clicked the "'+t.object.type+'" type object.'+(void 0===t.index?"":" Index = "+t.index+".")+" Position( x: "+o.x+", y: "+o.y+", z: "+o.z+" )")}},!1),function(){(a=new T.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.01,10)).position.copy(y),(s=new T.Scene).background=new T.Color(0),s.fog=new T.Fog(0,250,1400),(l=new T.WebGLRenderer({antialias:!0,canvas:g})).setPixelRatio(window.devicePixelRatio),l.setSizeOld=l.setSize,l.setSize=function(e,t,o){l.setSizeOld(e,t,o),setTimeout(function(){i.style.height=g.style.height,i.style.width=g.style.width,i.style.left=g.style.left,i.style.top=g.style.top,i.style.position=g.style.position,void 0!==p&&p.setSize(e,t)},0)},l.setSize(void 0!==E.canvas&&void 0!==E.canvas.width?E.canvas.width:g.clientWidth,void 0!==E.canvas&&void 0!==E.canvas.height?E.canvas.height:g.clientHeight),E.stereoEffect&&((u=new E.stereoEffect.StereoEffect(l,{spatialMultiplex:E.stereoEffect.spatialMultiplexsIndexs.Mono,far:a.far,camera:a,stereoAspect:1,cookie:q,elParent:g.parentElement})).options.spatialMultiplex=E.stereoEffect.spatialMultiplexsIndexs.Mono);var e=new T.PointLight(16777215,1);if(e.position.copy(new T.Vector3(1,1,1)),s.add(e),(e=new T.PointLight(16777215,1)).position.copy(new T.Vector3(-2,-2,-2)),s.add(e),d=new T.Group,s.add(d),E.dat&&(E.controllerPlay||E.stereoEffect)){var t=new dat.GUI({autoPlace:!1});void 0!==t.__closeButton.click&&t.__closeButton.click(),i.querySelector("#my-gui-container").appendChild(t.domElement)}if(S(d),E.controllerPlay){var o=new T.Color(16711680);f=controllerPlay.create(d,{onShowObject3D:function(e,t){e.visible=!0,void 0!==p&&p.setIndex(t)},onHideObject3D:function(e){e.visible=!1},onSelectedObject3D:function(e,t){e.material.color=o,e.visible=!0,void 0!==p&&p.setIndex(t)},onRestoreObject3D:function(e){e.material.color=e.userData.color,e.visible=!0},onRenamePlayButton:function(e,t){var o=document.getElementById("menuButtonPlay");null!==o&&(o.innerHTML=e,o.title=t)},onRenameRepeatButton:function(e,t){var o=document.getElementById("menuButtonRepeat");null!==o&&(o.title=e)}}),void 0!==t&&t.add(f)}if(void 0!==u&&void 0!==t)var n=E.stereoEffect.spatialMultiplexsIndexs;u.gui(t,{getLanguageCode:M.getLanguageCode,gui:t,stereoEffect:u,onChangeMode:function(e){var t=!0;switch(e){case n.Mono:t=!1;break;case n.SbS:case n.TaB:break;default:return void console.error("myThreejs: Invalid spatialMultiplexIndex = "+e)}r.onFullScreenToggle(!t)}}),E.menuPlay&&(p=new menuPlay.create(i,{stereoEffect:{stereoEffect:u,spatialMultiplexsIndexs:E.stereoEffect.spatialMultiplexsIndexs},playController:f,onFullScreenToggle:function(){return r.onFullScreenToggle()},onFullScreen:function(e,t){r.onFullScreenToggle(!e)}}),E.canvasMenu=p),E.orbitControls&&((c=new E.orbitControls(a,l.domElement)).target.set(2*s.position.x,2*s.position.y,2*s.position.z),c.update()),E.axesHelper&&(m=new T.AxesHelper(1*w,{cookie:q,scene:s,negativeAxes:!0,colors:128/255,colorsHelper:128,scales:E.axesHelper.scales}),s.add(m),void 0!==c&&c.update(),m.gui(t,{getLanguageCode:M.getLanguageCode,cookie:q,lang:{languageCode:"ru",axesHelper:"Оси координат",negativeAxes:"Минусовые оси",negativeAxesTitle:"Отображать отрицательные оси.",scales:"Шкалы",displayScales:"Показать",displayScalesTitle:"Показать или скрыть шкалы осей координат.",min:"Минимум",max:"Максимум",marks:"Риски",marksTitle:"Количество отметок на шкале",defaultButton:"Восстановить",defaultTitle:"Восстановить настройки осей координат по умолчанию.",zoom:"Масштаб",in:"увеличить",out:"уменьшить",wheelZoom:"Прокрутите колесико мыши для изменения масштаба",offset:"Сдвиг",add:"добавить",subtract:"вычесть",wheelPosition:"Прокрутите колесико мыши для изменения позиции"}})),void 0!==t&&(!0===E.orbitControlsGui&&OrbitControlsGui(t,c,{getLanguageCode:M.getLanguageCode,scales:E.axesHelper.scales}),dat.controllerNameAndTitle(t.add({defaultF:function(e){c.target=new T.Vector3,a.position.copy(y),c.object.position.copy(a.position),c.update()}},"defaultF"),R.defaultButton,R.defaultTitle)),d.children.forEach(function(e){void 0!==e.userData.raycaster&&(void 0===h&&((h=new T.Raycaster).params.Points.threshold=e.material.size/3,h.setStereoEffect({renderer:l,camera:a,stereoEffect:u,onIntersection:function(e){e.forEach(function(e){void 0!==e.object.userData.raycaster&&(e.object.userData.raycaster.onIntersection(h,e,s,e.object),v.push(e.object))})},onIntersectionOut:function(e){if(0!==v.length)for(v.forEach(function(e){e.userData.raycaster.onIntersectionOut(s,e)});0<v.length;)v.pop()},onMouseDown:function(e){var t=e[0];void 0!==t.object.userData.raycaster&&void 0!==t.object.userData.raycaster.onMouseDown&&t.object.userData.raycaster.onMouseDown(h,t,s),"Points"===t.object.type&&m.exposePosition(h.stereo.getPosition(t,!0))}})),h.stereo.addParticle(e))});var r=function(){var o={position:l.domElement.style.position,left:l.domElement.style.left,top:l.domElement.style.top,width:l.domElement.style.width,height:l.domElement.style.height},n=new T.Vector2;return l.getSize(n),{onFullScreenToggle:function(e){var t=new T.Vector2;return l.getSize(t),void 0===e&&(e=t.x===window.innerWidth&&t.y===window.innerHeight),e?(l.setSize(n.x,n.y),l.domElement.style.position=o.position,l.domElement.style.left=o.left,l.domElement.style.top=o.top,l.domElement.style.width=o.width,l.domElement.style.height=o.height):(l.setSize(window.innerWidth,window.innerHeight),l.domElement.style.position="fixed",l.domElement.style.left=0,l.domElement.style.top=0,l.domElement.style.width="100%",l.domElement.style.height="100%"),a.aspect=t.x/t.y,a.updateProjectionMatrix(),e=!e,L.display(i.parentElement,e),void 0!==p&&p.setFullScreenButton(e),e}}}();window.addEventListener("resize",b,!1)}(),function e(){requestAnimationFrame(e),x()}(),P.shift();var e=P.shift();void 0!==e&&t(e.create3Dobjects,e.options)}},e.addSpriteTextIntersection=function(e,t,o){var n=y(o);if(void 0===n){var r="rgb( 128, 128, 128 )",i=void 0===e.stereo?getPosition(t):e.stereo.getPosition(t,!0);y(o)||((n=new T.SpriteText("x: "+i.x+" y: "+i.y+" z: "+i.z,{textHeight:.1,fontColor:r,rect:{displayRect:!0,borderThickness:3,borderRadius:10,borderColor:r,backgroundColor:"rgba( 0, 0, 0, 1 )"},position:i.multiply(t.object.scale),center:new T.Vector2(.5,0)})).name=g,n.scale.divide(o.scale),o.add(n))}},e.removeSpriteTextIntersection=function(e){var t=!1;do{var o=y(e);void 0!==o&&(e.remove(o),t&&console.error("Duplicate spriteTextIntersection"),t=!0)}while(void 0!==o)},Object.defineProperty(e,"__esModule",{value:!0})});
